<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uthman Task Earn - Earning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-gradient {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .success-gradient {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .warning-gradient {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .coin-animation {
            animation: coinBounce 0.6s ease-out;
        }
        @keyframes coinBounce {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .notification-slide {
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="gradient-bg min-h-full">
    
    <!-- Login/Signup Page -->
    <div id="authPage" class="min-h-full flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md border-4 border-purple-200">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ’°</div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">Uthman Task Earn</h1>
                <p class="text-gray-600 font-medium">Complete Tasks & Earn Money</p>
            </div>
            
            <div class="mb-6">
                <div class="flex bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-1">
                    <button id="loginTab" class="flex-1 py-3 px-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold transition-all shadow-lg">Login</button>
                    <button id="signupTab" class="flex-1 py-3 px-4 rounded-xl text-purple-600 font-bold transition-all">Sign Up</button>
                </div>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginUsername" class="block text-sm font-bold text-gray-700 mb-2">ğŸ‘¤ Username</label>
                    <input type="text" id="loginUsername" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Enter username" required>
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-bold text-gray-700 mb-2">ğŸ”’ Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Enter password" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all shadow-lg transform hover:scale-105">ğŸš€ Login</button>
            </form>
            
            <!-- Signup Form -->
            <form id="signupForm" class="space-y-4 hidden">
                <div>
                    <label for="signupUsername" class="block text-sm font-bold text-gray-700 mb-2">ğŸ‘¤ Username</label>
                    <input type="text" id="signupUsername" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Choose unique username" required>
                </div>
                <div>
                    <label for="signupPhone" class="block text-sm font-bold text-gray-700 mb-2">ğŸ“± Phone Number</label>
                    <input type="tel" id="signupPhone" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Enter phone number" required>
                </div>
                <div>
                    <label for="signupPassword" class="block text-sm font-bold text-gray-700 mb-2">ğŸ”’ Password</label>
                    <input type="password" id="signupPassword" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Create strong password" required>
                </div>
                <div>
                    <label for="referralCode" class="block text-sm font-bold text-gray-700 mb-2">ğŸ¯ Referral Code (Required)</label>
                    <input type="text" id="referralCode" class="w-full px-4 py-3 border-2 border-orange-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-orange-50" placeholder="Enter valid referral code" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all shadow-lg transform hover:scale-105">âœ¨ Create Account</button>
            </form>
            
            <div id="authMessage" class="mt-4 text-center text-sm hidden"></div>
        </div>
    </div>
    
    <!-- User Dashboard -->
    <div id="userDashboard" class="hidden min-h-full">
        <nav class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 shadow-2xl">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸ’°</div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">Uthman Task Earn</h1>
                            <span id="userWelcome" class="text-purple-100 text-sm"></span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="bg-gradient-to-r from-yellow-400 to-orange-400 px-6 py-3 rounded-2xl shadow-lg">
                            <span class="text-white font-bold">ğŸ’° <span id="userCoins">0</span> Coins</span>
                        </div>
                        <button id="logoutBtn" class="bg-gradient-to-r from-red-500 to-pink-500 text-white px-6 py-3 rounded-2xl font-bold hover:from-red-600 hover:to-pink-600 transition-all shadow-lg">ğŸšª Logout</button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- News Section -->
        <div id="newsSection" class="max-w-7xl mx-auto p-6">
            <div id="newsList" class="space-y-4">
                <!-- News will be populated here -->
            </div>
        </div>
        
        <div class="max-w-7xl mx-auto p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Earnings Card -->
                <div class="bg-gradient-to-br from-green-400 to-blue-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ“Š Your Earnings</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Task Earnings:</span>
                            <span class="font-bold text-yellow-300" id="taskEarnings">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Referral Bonus:</span>
                            <span class="font-bold text-green-300" id="referralBonus">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Total Balance:</span>
                            <span class="font-bold text-orange-300" id="totalBalance">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Referral Card -->
                <div class="bg-gradient-to-br from-purple-400 to-pink-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ‘¥ Referral System</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm mb-2 font-medium">Your Referral Code:</label>
                            <div class="flex">
                                <input type="text" id="myReferralCode" class="flex-1 px-3 py-2 border-2 border-white rounded-l-xl bg-white bg-opacity-20 text-white placeholder-gray-200" readonly>
                                <button id="copyReferralBtn" class="bg-white text-purple-500 px-4 py-2 rounded-r-xl hover:bg-gray-100 transition-colors font-bold">ğŸ“‹ Copy</button>
                            </div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-xl p-3">
                            <p class="text-sm">ğŸ’¡ Share your code and earn bonus coins for each signup!</p>
                        </div>
                    </div>
                </div>
                
                <!-- Withdrawal Card -->
                <div class="bg-gradient-to-br from-orange-400 to-red-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ’³ Withdrawal</h3>
                    <div id="withdrawalClosed" class="text-center py-4">
                        <div class="text-6xl mb-3">ğŸ”’</div>
                        <p class="font-medium">Withdrawal portal is currently closed</p>
                    </div>
                    <div id="withdrawalOpen" class="hidden">
                        <button id="withdrawBtn" class="w-full bg-white text-orange-500 py-3 rounded-xl font-bold hover:bg-gray-100 transition-colors shadow-lg">ğŸ’° Withdraw Funds</button>
                        <p class="text-sm mt-2 text-center">Min: <span id="minWithdrawal">100</span> coins</p>
                    </div>
                </div>
                
                <!-- User Level Card -->
                <div class="bg-gradient-to-br from-indigo-400 to-purple-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ‘‘ Your Level</h3>
                    <div id="userLevelInfo" class="space-y-3">
                        <!-- Level info will be populated here -->
                    </div>
                </div>
                
                <!-- Promo Code Card -->
                <div class="bg-gradient-to-br from-pink-400 to-red-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ Promo Code</h3>
                    <form id="promoCodeForm" class="space-y-3">
                        <input type="text" id="promoCodeInput" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Enter promo code">
                        <button type="submit" class="w-full bg-white text-pink-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ¯ Redeem Code</button>
                    </form>
                </div>
            </div>
            
            <!-- Notifications -->
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ”” Notifications</h3>
                <div id="notificationsList" class="space-y-3 max-h-60 overflow-y-auto">
                    <!-- Notifications will be populated here -->
                </div>
            </div>
            
            <!-- Achievements -->
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ† Achievements</h3>
                <div id="achievementsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Achievements will be populated here -->
                </div>
            </div>
            
            <!-- Transaction History -->
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ“ˆ Transaction History</h3>
                <div id="transactionHistory" class="space-y-3 max-h-60 overflow-y-auto">
                    <!-- Transaction history will be populated here -->
                </div>
            </div>
            
            <!-- Message Admin -->
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ’¬ Message Admin</h3>
                <form id="messageAdminForm" class="space-y-4">
                    <div>
                        <label for="messageSubject" class="block text-sm font-bold text-gray-700 mb-2">Subject</label>
                        <input type="text" id="messageSubject" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Enter message subject" required>
                    </div>
                    <div>
                        <label for="messageContent" class="block text-sm font-bold text-gray-700 mb-2">Message</label>
                        <textarea id="messageContent" rows="4" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Type your message to admin..." required></textarea>
                    </div>
                    <button type="submit" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-600 hover:to-purple-600 transition-all shadow-lg">ğŸ“¨ Send Message</button>
                </form>
                
                <div class="mt-6">
                    <h4 class="font-bold text-gray-700 mb-3">Admin Replies:</h4>
                    <div id="adminRepliesList" class="space-y-3 max-h-60 overflow-y-auto">
                        <!-- Admin replies will be shown here -->
                    </div>
                </div>
            </div>

            <!-- Available Tasks -->
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ¯ Available Tasks</h3>
                <div class="mb-4">
                    <label for="taskFilter" class="block text-sm font-bold text-gray-700 mb-2">Filter by Category:</label>
                    <select id="taskFilter" class="px-4 py-2 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500">
                        <option value="all">All Categories</option>
                        <option value="social">Social Media</option>
                        <option value="survey">Survey</option>
                        <option value="download">Download</option>
                        <option value="review">Review</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div id="tasksList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Tasks will be populated here -->
                </div>
            </div>
            
            <!-- FAQ Section -->
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">â“ Frequently Asked Questions</h3>
                <div id="faqSection" class="space-y-4">
                    <!-- FAQ items will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-full">
        <nav class="bg-gradient-to-r from-red-600 via-purple-600 to-indigo-600 text-white shadow-2xl">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸ”§</div>
                        <h1 class="text-2xl font-bold">Admin Control Panel</h1>
                    </div>
                    <button id="adminLogoutBtn" class="bg-red-700 px-6 py-3 rounded-2xl hover:bg-red-800 transition-colors font-bold shadow-lg">ğŸšª Logout</button>
                </div>
            </div>
        </nav>
        
        <div class="max-w-7xl mx-auto p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Stats Card -->
                <div class="bg-gradient-to-br from-blue-400 to-purple-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ“Š Platform Stats</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Total Users:</span>
                            <span class="font-bold text-yellow-300" id="totalSignups">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Blocked Users:</span>
                            <span class="font-bold text-red-300" id="blockedUsers">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Pending Tasks:</span>
                            <span class="font-bold text-orange-300" id="pendingTasks">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Withdrawal Control -->
                <div class="bg-gradient-to-br from-green-400 to-teal-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ’³ Withdrawal Control</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Portal Status:</span>
                            <button id="toggleWithdrawal" class="bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition-colors font-bold">Closed</button>
                        </div>
                        <div>
                            <label class="block text-sm mb-2 font-medium">Minimum Withdrawal:</label>
                            <input type="number" id="minWithdrawalInput" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="100" min="1">
                            <button id="updateMinWithdrawal" class="w-full mt-2 bg-white text-green-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">Update</button>
                        </div>
                    </div>
                </div>
                
                <!-- User Management -->
                <div class="bg-gradient-to-br from-orange-400 to-red-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ‘¥ User Management</h3>
                    <div class="space-y-3">
                        <input type="text" id="blockUsername" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Username to block">
                        <button id="blockUserBtn" class="w-full bg-white text-red-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸš« Block User</button>
                        <button id="viewUsersBtn" class="w-full bg-white text-orange-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ‘€ View All Users</button>
                    </div>
                </div>
                
                <!-- Analytics Card -->
                <div class="bg-gradient-to-br from-cyan-400 to-blue-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ“Š Analytics</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Today's Signups:</span>
                            <span class="font-bold text-yellow-300" id="todaySignups">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Active Users:</span>
                            <span class="font-bold text-green-300" id="activeUsers">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Total Earnings:</span>
                            <span class="font-bold text-orange-300" id="totalEarnings">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Promo Code Management -->
                <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ Promo Codes</h3>
                    <div class="space-y-3">
                        <input type="text" id="promoCodeName" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Promo name">
                        <input type="number" id="promoCodeReward" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Reward amount" min="1">
                        <input type="number" id="promoCodeLimit" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Usage limit" min="1">
                        <button id="createPromoBtn" class="w-full bg-white text-yellow-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ¯ Create Promo</button>
                    </div>
                </div>
                
                <!-- Coin Management -->
                <div class="bg-gradient-to-br from-red-400 to-purple-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ’° Coin Management</h3>
                    <div class="space-y-3">
                        <input type="text" id="coinUsername" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Username">
                        <input type="number" id="coinAmount" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Amount to remove" min="1">
                        <button id="removeCoinBtn" class="w-full bg-white text-red-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ’¸ Remove Coins</button>
                        <input type="text" id="addCoinUsername" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Username">
                        <input type="number" id="addCoinAmount" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Amount to add" min="1">
                        <button id="addCoinBtn" class="w-full bg-white text-green-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ’ Add Coins</button>
                    </div>
                </div>
            </div>
            
            <!-- News Management -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ“¢ News Management</h3>
                <form id="addNewsForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="newsTitle" class="block text-sm font-bold text-gray-700 mb-2">News Title</label>
                            <input type="text" id="newsTitle" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Enter news title" required>
                        </div>
                        <div>
                            <label for="newsDuration" class="block text-sm font-bold text-gray-700 mb-2">Duration (hours)</label>
                            <input type="number" id="newsDuration" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="24" min="1" required>
                        </div>
                    </div>
                    <div>
                        <label for="newsContent" class="block text-sm font-bold text-gray-700 mb-2">News Content</label>
                        <textarea id="newsContent" rows="3" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Enter news content" required></textarea>
                    </div>
                    <button type="submit" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all shadow-lg">ğŸ“¢ Post News</button>
                </form>
                
                <div class="mt-6">
                    <h4 class="font-bold text-gray-700 mb-3">Active News:</h4>
                    <div id="adminNewsList" class="space-y-3 max-h-60 overflow-y-auto">
                        <!-- Active news will be listed here -->
                    </div>
                </div>
            </div>
            
            <!-- Task Management -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ¯ Task Management</h3>
                <form id="addTaskForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="taskTitle" class="block text-sm font-bold text-gray-700 mb-2">Task Title</label>
                            <input type="text" id="taskTitle" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500" placeholder="Enter task title" required>
                        </div>
                        <div>
                            <label for="taskReward" class="block text-sm font-bold text-gray-700 mb-2">Reward (Coins)</label>
                            <input type="number" id="taskReward" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500" placeholder="50" min="1" required>
                        </div>
                        <div>
                            <label for="taskLimit" class="block text-sm font-bold text-gray-700 mb-2">User Limit</label>
                            <input type="number" id="taskLimit" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500" placeholder="100" min="1" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="taskCategory" class="block text-sm font-bold text-gray-700 mb-2">Category</label>
                            <select id="taskCategory" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500">
                                <option value="social">Social Media</option>
                                <option value="survey">Survey</option>
                                <option value="download">Download</option>
                                <option value="review">Review</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="taskDifficulty" class="block text-sm font-bold text-gray-700 mb-2">Difficulty</label>
                            <select id="taskDifficulty" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500">
                                <option value="easy">Easy</option>
                                <option value="medium">Medium</option>
                                <option value="hard">Hard</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="taskDescription" class="block text-sm font-bold text-gray-700 mb-2">Task Description</label>
                        <textarea id="taskDescription" rows="3" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500" placeholder="Describe what users need to do" required></textarea>
                    </div>
                    <div>
                        <label for="taskLink" class="block text-sm font-bold text-gray-700 mb-2">Task Link (Optional)</label>
                        <input type="url" id="taskLink" class="w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:ring-2 focus:ring-blue-500" placeholder="https://example.com">
                    </div>
                    <button type="submit" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-600 hover:to-purple-600 transition-all shadow-lg">ğŸ¯ Add Task</button>
                </form>
            </div>
            
            <!-- Active Promo Codes -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ Active Promo Codes</h3>
                <div id="activePromoCodes" class="space-y-3 max-h-60 overflow-y-auto">
                    <!-- Active promo codes will be listed here -->
                </div>
            </div>
            
            <!-- FAQ Management -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">â“ FAQ Management</h3>
                <form id="addFaqForm" class="space-y-4 mb-6">
                    <div>
                        <label for="faqQuestion" class="block text-sm font-bold text-gray-700 mb-2">Question</label>
                        <input type="text" id="faqQuestion" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Enter FAQ question" required>
                    </div>
                    <div>
                        <label for="faqAnswer" class="block text-sm font-bold text-gray-700 mb-2">Answer</label>
                        <textarea id="faqAnswer" rows="3" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Enter FAQ answer" required></textarea>
                    </div>
                    <button type="submit" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all shadow-lg">â“ Add FAQ</button>
                </form>
                
                <div>
                    <h4 class="font-bold text-gray-700 mb-3">Current FAQ Items:</h4>
                    <div id="faqList" class="space-y-3 max-h-60 overflow-y-auto">
                        <!-- FAQ items will be listed here -->
                    </div>
                </div>
            </div>

            <!-- User Management -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ‘¥ All Users</h3>
                <div id="allUsersList" class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- All users will be listed here -->
                </div>
            </div>

            <!-- Messages from Users -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ’¬ User Messages</h3>
                <div id="userMessagesList" class="space-y-4 max-h-96 overflow-y-auto">
                    <!-- User messages will be listed here -->
                </div>
            </div>
            
            <!-- Pending Approvals -->
            <div class="mt-6 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">â³ Pending Approvals</h3>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="font-bold text-gray-700">Task Submissions:</h4>
                            <button id="approveAllTasksBtn" class="bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600 transition-colors font-bold">âœ… Approve All</button>
                        </div>
                        <div id="pendingTaskSubmissions" class="space-y-3 max-h-60 overflow-y-auto">
                            <!-- Pending task submissions will be listed here -->
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-700 mb-3">Withdrawal Requests:</h4>
                        <div id="pendingWithdrawals" class="space-y-3 max-h-60 overflow-y-auto">
                            <!-- Pending withdrawals will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Submission Modal -->
    <div id="taskSubmissionModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">ğŸ“¤ Submit Task Proof</h3>
            <form id="taskSubmissionForm" class="space-y-4">
                <input type="hidden" id="submissionTaskId">
                <div>
                    <label for="proofFile" class="block text-sm font-bold text-gray-700 mb-2">Upload Proof (Max 3MB)</label>
                    <input type="file" id="proofFile" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" accept="image/*,video/*,.pdf" required>
                </div>
                <div>
                    <label for="proofDescription" class="block text-sm font-bold text-gray-700 mb-2">Description</label>
                    <textarea id="proofDescription" rows="3" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Describe your completion proof" required></textarea>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all">ğŸ“¤ Submit</button>
                    <button type="button" id="cancelSubmission" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 transition-colors">âŒ Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Withdrawal Modal -->
    <div id="withdrawalModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">ğŸ’³ Withdraw Funds</h3>
            <form id="withdrawalForm" class="space-y-4">
                <div>
                    <label for="withdrawAmount" class="block text-sm font-bold text-gray-700 mb-2">Amount (Coins)</label>
                    <input type="number" id="withdrawAmount" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="Enter amount" min="1" required>
                </div>
                <div>
                    <label for="bankName" class="block text-sm font-bold text-gray-700 mb-2">Bank Name</label>
                    <input type="text" id="bankName" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="Enter bank name" required>
                </div>
                <div>
                    <label for="accountName" class="block text-sm font-bold text-gray-700 mb-2">Account Name</label>
                    <input type="text" id="accountName" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="Enter account name" required>
                </div>
                <div>
                    <label for="accountNumber" class="block text-sm font-bold text-gray-700 mb-2">Account Number</label>
                    <input type="text" id="accountNumber" class="w-full px-4 py-3 border-2 border-green-200 rounded-xl focus:ring-2 focus:ring-green-500" placeholder="Enter account number" required>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all">ğŸ’° Request Withdrawal</button>
                    <button type="button" id="cancelWithdrawal" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 transition-colors">âŒ Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="imageViewerModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-6 w-full max-w-4xl max-h-full overflow-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">ğŸ“· Task Proof Image</h3>
                <button id="closeImageViewer" class="bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition-colors">âŒ Close</button>
            </div>
            <div class="text-center">
                <img id="proofImage" src="" alt="Task proof" class="max-w-full max-h-96 rounded-xl shadow-lg mx-auto">
                <div id="imageDetails" class="mt-4 text-gray-600">
                    <!-- Image details will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">ğŸ’¬ Reply to User</h3>
            <form id="replyForm" class="space-y-4">
                <input type="hidden" id="replyToUsername">
                <input type="hidden" id="replyToMessageId">
                <div>
                    <label for="replySubject" class="block text-sm font-bold text-gray-700 mb-2">Subject</label>
                    <input type="text" id="replySubject" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" readonly>
                </div>
                <div>
                    <label for="replyContent" class="block text-sm font-bold text-gray-700 mb-2">Reply</label>
                    <textarea id="replyContent" rows="4" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Type your reply..." required></textarea>
                </div>
                <div class="flex space-x-3">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-xl font-bold hover:from-blue-600 hover:to-purple-600 transition-all">ğŸ“¨ Send Reply</button>
                    <button type="button" id="cancelReply" class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 transition-colors">âŒ Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // App State
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('uthman_users') || '{}');
        let tasks = JSON.parse(localStorage.getItem('uthman_tasks') || '[]');
        let news = JSON.parse(localStorage.getItem('uthman_news') || '[]');
        let withdrawalOpen = JSON.parse(localStorage.getItem('uthman_withdrawal_open') || 'false');
        let minWithdrawal = JSON.parse(localStorage.getItem('uthman_min_withdrawal') || '100');
        let withdrawalRequests = JSON.parse(localStorage.getItem('uthman_withdrawals') || '[]');
        let taskSubmissions = JSON.parse(localStorage.getItem('uthman_task_submissions') || '[]');
        let blockedUsers = JSON.parse(localStorage.getItem('uthman_blocked_users') || '[]');
        let messages = JSON.parse(localStorage.getItem('uthman_messages') || '[]');
        let adminReplies = JSON.parse(localStorage.getItem('uthman_admin_replies') || '[]');
        let promoCodes = JSON.parse(localStorage.getItem('uthman_promo_codes') || '[]');
        let userLevels = JSON.parse(localStorage.getItem('uthman_user_levels') || '{}');
        let dailyLogins = JSON.parse(localStorage.getItem('uthman_daily_logins') || '{}');
        let achievements = JSON.parse(localStorage.getItem('uthman_achievements') || '{}');
        let taskCategories = JSON.parse(localStorage.getItem('uthman_task_categories') || '[]');
        let notifications = JSON.parse(localStorage.getItem('uthman_notifications') || '[]');
        let supportTickets = JSON.parse(localStorage.getItem('uthman_support_tickets') || '[]');
        let faqItems = JSON.parse(localStorage.getItem('uthman_faq') || '[]');
        let platformStats = JSON.parse(localStorage.getItem('uthman_platform_stats') || '{}');
        
        // User level system
        const levelThresholds = [
            { level: 1, name: 'Bronze', minEarnings: 0, bonus: 0, color: 'from-yellow-600 to-yellow-800' },
            { level: 2, name: 'Silver', minEarnings: 500, bonus: 0.1, color: 'from-gray-400 to-gray-600' },
            { level: 3, name: 'Gold', minEarnings: 1500, bonus: 0.2, color: 'from-yellow-400 to-yellow-600' },
            { level: 4, name: 'Platinum', minEarnings: 3000, bonus: 0.3, color: 'from-purple-400 to-purple-600' },
            { level: 5, name: 'Diamond', minEarnings: 6000, bonus: 0.5, color: 'from-blue-400 to-cyan-400' }
        ];
        
        // Achievement definitions
        const achievementDefinitions = [
            { id: 'first_task', name: 'First Steps', description: 'Complete your first task', reward: 25, icon: 'ğŸ¯' },
            { id: 'task_master_10', name: 'Task Master', description: 'Complete 10 tasks', reward: 100, icon: 'ğŸ†' },
            { id: 'task_master_50', name: 'Task Legend', description: 'Complete 50 tasks', reward: 500, icon: 'ğŸ‘‘' },
            { id: 'referral_king', name: 'Referral King', description: 'Refer 10 users', reward: 200, icon: 'ğŸ‘¥' },
            { id: 'daily_warrior', name: 'Daily Warrior', description: 'Login 7 days in a row', reward: 150, icon: 'ğŸ”¥' },
            { id: 'big_earner', name: 'Big Earner', description: 'Earn 1000 coins', reward: 100, icon: 'ğŸ’°' }
        ];
        
        // Check device restriction
        function checkDeviceRestriction(username) {
            const deviceUser = localStorage.getItem('uthman_device_user');
            if (deviceUser && deviceUser !== username && !blockedUsers.includes(deviceUser)) {
                return false;
            }
            return true;
        }
        
        // Generate unique referral code
        function generateReferralCode(username) {
            let code;
            let attempts = 0;
            do {
                code = 'UTE' + username.substring(0, 3).toUpperCase() + Math.random().toString(36).substr(2, 4).toUpperCase();
                attempts++;
                if (attempts > 100) break; // Prevent infinite loop
            } while (Object.values(users).some(user => user.referralCode === code));
            return code;
        }
        
        // Get user level
        function getUserLevel(totalEarnings) {
            for (let i = levelThresholds.length - 1; i >= 0; i--) {
                if (totalEarnings >= levelThresholds[i].minEarnings) {
                    return levelThresholds[i];
                }
            }
            return levelThresholds[0];
        }
        
        // Check daily login
        function checkDailyLogin(username) {
            const today = new Date().toDateString();
            const userLogins = dailyLogins[username] || [];
            
            if (!userLogins.includes(today)) {
                userLogins.push(today);
                dailyLogins[username] = userLogins;
                
                // Award daily login bonus
                const user = users[username];
                const bonus = 10 + (userLogins.length % 7 === 0 ? 50 : 0); // Extra bonus every 7 days
                user.referralBonus += bonus;
                user.transactions.push({
                    type: 'daily_login',
                    amount: bonus,
                    description: `Daily login bonus (Day ${userLogins.length})`,
                    timestamp: new Date().toLocaleString()
                });
                
                // Check daily warrior achievement
                if (userLogins.length >= 7) {
                    checkAchievement(username, 'daily_warrior');
                }
                
                saveData();
                return bonus;
            }
            return 0;
        }
        
        // Check achievements
        function checkAchievement(username, achievementId) {
            const userAchievements = achievements[username] || [];
            if (userAchievements.includes(achievementId)) return;
            
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;
            
            const user = users[username];
            let earned = false;
            
            switch (achievementId) {
                case 'first_task':
                    earned = user.completedTasks.length >= 1;
                    break;
                case 'task_master_10':
                    earned = user.completedTasks.length >= 10;
                    break;
                case 'task_master_50':
                    earned = user.completedTasks.length >= 50;
                    break;
                case 'referral_king':
                    const referrals = Object.values(users).filter(u => 
                        Object.values(users).some(referrer => 
                            referrer.referralCode && u.referredBy === referrer.referralCode && referrer.username === username
                        )
                    ).length;
                    earned = referrals >= 10;
                    break;
                case 'big_earner':
                    earned = (user.taskEarnings + user.referralBonus) >= 1000;
                    break;
                case 'daily_warrior':
                    const userLogins = dailyLogins[username] || [];
                    earned = userLogins.length >= 7;
                    break;
            }
            
            if (earned) {
                userAchievements.push(achievementId);
                achievements[username] = userAchievements;
                
                user.referralBonus += achievement.reward;
                user.transactions.push({
                    type: 'achievement',
                    amount: achievement.reward,
                    description: `Achievement unlocked: ${achievement.name}`,
                    timestamp: new Date().toLocaleString()
                });
                
                addNotification(username, `ğŸ† Achievement Unlocked: ${achievement.name}! +${achievement.reward} coins`);
                saveData();
            }
        }
        
        // Add notification
        function addNotification(username, message) {
            const notification = {
                id: Date.now(),
                username,
                message,
                timestamp: new Date().toLocaleString(),
                read: false
            };
            notifications.push(notification);
        }
        
        // Generate promo code
        function generatePromoCode() {
            return 'PROMO' + Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        // Update last online
        function updateLastOnline(username) {
            if (users[username]) {
                users[username].lastOnline = new Date().toISOString();
                saveData();
            }
        }
        
        // Save data
        function saveData() {
            localStorage.setItem('uthman_users', JSON.stringify(users));
            localStorage.setItem('uthman_tasks', JSON.stringify(tasks));
            localStorage.setItem('uthman_news', JSON.stringify(news));
            localStorage.setItem('uthman_withdrawal_open', JSON.stringify(withdrawalOpen));
            localStorage.setItem('uthman_min_withdrawal', JSON.stringify(minWithdrawal));
            localStorage.setItem('uthman_withdrawals', JSON.stringify(withdrawalRequests));
            localStorage.setItem('uthman_task_submissions', JSON.stringify(taskSubmissions));
            localStorage.setItem('uthman_blocked_users', JSON.stringify(blockedUsers));
            localStorage.setItem('uthman_messages', JSON.stringify(messages));
            localStorage.setItem('uthman_admin_replies', JSON.stringify(adminReplies));
            localStorage.setItem('uthman_promo_codes', JSON.stringify(promoCodes));
            localStorage.setItem('uthman_user_levels', JSON.stringify(userLevels));
            localStorage.setItem('uthman_daily_logins', JSON.stringify(dailyLogins));
            localStorage.setItem('uthman_achievements', JSON.stringify(achievements));
            localStorage.setItem('uthman_task_categories', JSON.stringify(taskCategories));
            localStorage.setItem('uthman_notifications', JSON.stringify(notifications));
            localStorage.setItem('uthman_support_tickets', JSON.stringify(supportTickets));
            localStorage.setItem('uthman_faq', JSON.stringify(faqItems));
            localStorage.setItem('uthman_platform_stats', JSON.stringify(platformStats));
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-2xl shadow-2xl notification-slide max-w-sm ${
                type === 'error' ? 'bg-gradient-to-r from-red-500 to-pink-500' : 
                type === 'success' ? 'bg-gradient-to-r from-green-500 to-blue-500' : 
                'bg-gradient-to-r from-purple-500 to-pink-500'
            } text-white font-bold`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
        
        // Show message in auth
        function showMessage(message, type = 'info') {
            const messageEl = document.getElementById('authMessage');
            messageEl.textContent = message;
            messageEl.className = `mt-4 text-center text-sm font-bold ${type === 'error' ? 'text-red-600' : type === 'success' ? 'text-green-600' : 'text-blue-600'}`;
            messageEl.classList.remove('hidden');
            setTimeout(() => messageEl.classList.add('hidden'), 4000);
        }
        
        // Switch between login and signup
        document.getElementById('loginTab').addEventListener('click', () => {
            document.getElementById('loginTab').className = 'flex-1 py-3 px-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold transition-all shadow-lg';
            document.getElementById('signupTab').className = 'flex-1 py-3 px-4 rounded-xl text-purple-600 font-bold transition-all';
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
        });
        
        document.getElementById('signupTab').addEventListener('click', () => {
            document.getElementById('signupTab').className = 'flex-1 py-3 px-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold transition-all shadow-lg';
            document.getElementById('loginTab').className = 'flex-1 py-3 px-4 rounded-xl text-purple-600 font-bold transition-all';
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('hidden');
        });
        
        // Login
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            // Check if user is blocked
            if (blockedUsers.includes(username)) {
                showMessage('Your account has been blocked. Contact admin.', 'error');
                return;
            }
            
            // Admin login
            if (username === 'admin' && password === 'admin') {
                currentUser = { username: 'admin', isAdmin: true };
                showAdminDashboard();
                return;
            }
            
            // Regular user login
            if (users[username] && users[username].password === password) {
                if (!checkDeviceRestriction(username)) {
                    showMessage('This device is registered to another user', 'error');
                    return;
                }
                currentUser = users[username];
                updateLastOnline(username);
                localStorage.setItem('uthman_device_user', username);
                
                // Check daily login bonus
                const loginBonus = checkDailyLogin(username);
                if (loginBonus > 0) {
                    showNotification(`Daily login bonus: +${loginBonus} coins! ğŸ‰`, 'success');
                }
                
                // Check achievements
                checkAchievement(username, 'big_earner');
                
                showUserDashboard();
            } else {
                showMessage('Invalid username or password', 'error');
            }
        });
        
        // Signup
        document.getElementById('signupForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('signupUsername').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const password = document.getElementById('signupPassword').value;
            const referralCode = document.getElementById('referralCode').value.trim();
            
            // Validation
            if (users[username]) {
                showMessage('Username already exists', 'error');
                return;
            }
            
            if (blockedUsers.includes(username)) {
                showMessage('This username is blocked', 'error');
                return;
            }
            
            if (!checkDeviceRestriction(username)) {
                showMessage('This device is already registered to another user', 'error');
                return;
            }
            
            // Check referral code
            let referrer = null;
            let isAdminCode = false;
            
            if (referralCode === 'adminuthman') {
                isAdminCode = true;
            } else {
                referrer = Object.values(users).find(user => user.referralCode === referralCode);
                if (!referrer) {
                    showMessage('Invalid referral code. Please get a valid code from an existing user.', 'error');
                    return;
                }
            }
            
            // Create new user
            const newUser = {
                username,
                phone,
                password,
                taskEarnings: 0,
                referralBonus: 0,
                referralCode: generateReferralCode(username),
                completedTasks: [],
                transactions: [],
                signupDate: new Date().toISOString(),
                lastOnline: new Date().toISOString()
            };
            
            // Award referral bonus
            if (isAdminCode) {
                // Admin referral code - only user gets welcome bonus
                newUser.referralBonus += 50; // Higher welcome bonus for admin code
                newUser.transactions.push({
                    type: 'referral',
                    amount: 50,
                    description: 'Welcome bonus from admin referral code',
                    timestamp: new Date().toLocaleString()
                });
            } else {
                // Regular user referral
                referrer.referralBonus += 50;
                referrer.transactions.push({
                    type: 'referral',
                    amount: 50,
                    description: `Referral bonus from ${username}`,
                    timestamp: new Date().toLocaleString()
                });
                
                newUser.referralBonus += 25; // Welcome bonus for using referral
                newUser.transactions.push({
                    type: 'referral',
                    amount: 25,
                    description: 'Welcome bonus for using referral code',
                    timestamp: new Date().toLocaleString()
                });
            }
            
            users[username] = newUser;
            localStorage.setItem('uthman_device_user', username);
            saveData();
            
            showMessage('Account created successfully! Welcome bonus awarded!', 'success');
            
            // Clear form
            document.getElementById('signupForm').reset();
        });
        
        // Show user dashboard
        function showUserDashboard() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('userDashboard').classList.remove('hidden');
            
            updateUserDashboard();
        }
        
        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('authPage').classList.add('hidden');
            document.getElementById('userDashboard').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            
            updateAdminDashboard();
        }
        
        // Update user dashboard
        function updateUserDashboard() {
            const totalBalance = currentUser.taskEarnings + currentUser.referralBonus;
            
            document.getElementById('userWelcome').textContent = `Welcome back, ${currentUser.username}! ğŸ‰`;
            document.getElementById('userCoins').textContent = totalBalance;
            document.getElementById('taskEarnings').textContent = currentUser.taskEarnings;
            document.getElementById('referralBonus').textContent = currentUser.referralBonus;
            document.getElementById('totalBalance').textContent = totalBalance;
            document.getElementById('myReferralCode').value = currentUser.referralCode;
            document.getElementById('minWithdrawal').textContent = minWithdrawal;
            
            // Update withdrawal status - check both portal status AND user balance
            const withdrawalClosedEl = document.getElementById('withdrawalClosed');
            const withdrawalOpenEl = document.getElementById('withdrawalOpen');
            
            if (withdrawalOpen && totalBalance >= minWithdrawal) {
                withdrawalClosedEl.classList.add('hidden');
                withdrawalOpenEl.classList.remove('hidden');
            } else {
                withdrawalClosedEl.classList.remove('hidden');
                withdrawalOpenEl.classList.add('hidden');
                
                // Update the closed message based on reason
                if (!withdrawalOpen) {
                    withdrawalClosedEl.innerHTML = `
                        <div class="text-center py-4">
                            <div class="text-6xl mb-3">ğŸ”’</div>
                            <p class="font-medium">Withdrawal portal is currently closed</p>
                            <p class="text-sm text-orange-200 mt-2">Check back later or contact admin</p>
                        </div>
                    `;
                } else if (totalBalance < minWithdrawal) {
                    withdrawalClosedEl.innerHTML = `
                        <div class="text-center py-4">
                            <div class="text-6xl mb-3">ğŸ’°</div>
                            <p class="font-medium">Minimum ${minWithdrawal} coins required</p>
                            <p class="text-sm text-orange-200 mt-2">You need ${minWithdrawal - totalBalance} more coins</p>
                        </div>
                    `;
                }
            }
            
            updateNewsList();
            updateTasksList();
            updateTransactionHistory();
            updateAdminReplies();
            updateUserLevel();
            updateNotifications();
            updateAchievements();
            updateFAQSection();
        }
        
        // Update user level
        function updateUserLevel() {
            const totalEarnings = currentUser.taskEarnings + currentUser.referralBonus;
            const userLevel = getUserLevel(totalEarnings);
            const nextLevel = levelThresholds.find(l => l.minEarnings > totalEarnings);
            
            const levelInfo = document.getElementById('userLevelInfo');
            levelInfo.innerHTML = `
                <div class="bg-gradient-to-r ${userLevel.color} rounded-xl p-3 text-center">
                    <div class="text-2xl font-bold">${userLevel.name}</div>
                    <div class="text-sm">Level ${userLevel.level}</div>
                </div>
                <div class="bg-white bg-opacity-20 rounded-xl p-3">
                    <div class="text-sm">Bonus: +${(userLevel.bonus * 100).toFixed(0)}% on tasks</div>
                    ${nextLevel ? `<div class="text-sm">Next: ${nextLevel.minEarnings - totalEarnings} coins to ${nextLevel.name}</div>` : '<div class="text-sm">ğŸ† Max Level Reached!</div>'}
                </div>
            `;
        }
        
        // Update notifications
        function updateNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = '';
            
            const userNotifications = notifications.filter(n => n.username === currentUser.username).slice(-10).reverse();
            
            if (userNotifications.length === 0) {
                notificationsList.innerHTML = '<p class="text-gray-500 text-center py-4">No notifications yet</p>';
                return;
            }
            
            userNotifications.forEach(notification => {
                const notificationEl = document.createElement('div');
                notificationEl.className = `p-4 rounded-xl ${notification.read ? 'bg-gray-50' : 'bg-blue-50 border border-blue-200'}`;
                notificationEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="text-gray-800">${notification.message}</div>
                            <div class="text-xs text-gray-500 mt-1">${notification.timestamp}</div>
                        </div>
                        ${!notification.read ? '<div class="w-3 h-3 bg-blue-500 rounded-full ml-2 mt-1"></div>' : ''}
                    </div>
                `;
                notificationsList.appendChild(notificationEl);
            });
        }
        
        // Update achievements
        function updateAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            achievementsList.innerHTML = '';
            
            const userAchievements = achievements[currentUser.username] || [];
            
            achievementDefinitions.forEach(achievement => {
                const isUnlocked = userAchievements.includes(achievement.id);
                const achievementEl = document.createElement('div');
                achievementEl.className = `p-4 rounded-xl border-2 ${isUnlocked ? 'bg-gradient-to-br from-yellow-100 to-orange-100 border-yellow-300' : 'bg-gray-100 border-gray-300'}`;
                achievementEl.innerHTML = `
                    <div class="text-center">
                        <div class="text-3xl mb-2 ${isUnlocked ? '' : 'grayscale opacity-50'}">${achievement.icon}</div>
                        <div class="font-bold text-gray-800">${achievement.name}</div>
                        <div class="text-sm text-gray-600 mb-2">${achievement.description}</div>
                        <div class="text-sm font-bold ${isUnlocked ? 'text-green-600' : 'text-gray-500'}">
                            ${isUnlocked ? 'âœ… Unlocked' : `ğŸ”’ ${achievement.reward} coins`}
                        </div>
                    </div>
                `;
                achievementsList.appendChild(achievementEl);
            });
        }
        
        // Update FAQ section
        function updateFAQSection() {
            const faqSection = document.getElementById('faqSection');
            faqSection.innerHTML = '';
            
            if (faqItems.length === 0) {
                faqSection.innerHTML = '<p class="text-gray-500 text-center py-4">No FAQ items available</p>';
                return;
            }
            
            faqItems.forEach(faq => {
                const faqEl = document.createElement('div');
                faqEl.className = 'border border-gray-200 rounded-xl overflow-hidden';
                faqEl.innerHTML = `
                    <button class="w-full text-left p-4 bg-gray-50 hover:bg-gray-100 transition-colors font-bold text-gray-800 flex justify-between items-center" onclick="toggleFAQ(${faq.id})">
                        <span>${faq.question}</span>
                        <span id="faq-icon-${faq.id}">â–¼</span>
                    </button>
                    <div id="faq-answer-${faq.id}" class="hidden p-4 bg-white text-gray-700">
                        ${faq.answer}
                    </div>
                `;
                faqSection.appendChild(faqEl);
            });
        }
        
        // Update news list
        function updateNewsList() {
            const newsList = document.getElementById('newsList');
            newsList.innerHTML = '';
            
            // Filter active news
            const activeNews = news.filter(item => {
                const expiryTime = new Date(item.timestamp).getTime() + (item.duration * 60 * 60 * 1000);
                return Date.now() < expiryTime;
            });
            
            activeNews.forEach(item => {
                const newsEl = document.createElement('div');
                newsEl.className = 'bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-6 text-white shadow-2xl fade-in';
                newsEl.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="text-3xl">ğŸ“¢</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-xl mb-2">${item.title}</h4>
                            <p class="text-yellow-100 mb-2">${item.content}</p>
                            <p class="text-xs text-yellow-200">Posted: ${new Date(item.timestamp).toLocaleString()}</p>
                        </div>
                    </div>
                `;
                newsList.appendChild(newsEl);
            });
        }
        
        // Update tasks list
        function updateTasksList() {
            const tasksList = document.getElementById('tasksList');
            const filter = document.getElementById('taskFilter').value;
            tasksList.innerHTML = '';
            
            const filteredTasks = filter === 'all' ? tasks : tasks.filter(task => task.category === filter);
            
            if (filteredTasks.length === 0) {
                tasksList.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">No tasks available in this category</div>';
                return;
            }
            
            filteredTasks.forEach(task => {
                const isCompleted = currentUser.completedTasks.includes(task.id);
                const hasPendingSubmission = taskSubmissions.some(sub => 
                    sub.taskId === task.id && sub.username === currentUser.username && sub.status === 'pending'
                );
                const completedCount = task.completions || 0;
                const isTaskFull = task.limit && completedCount >= task.limit;
                
                // Calculate reward with level bonus
                const userLevel = getUserLevel(currentUser.taskEarnings + currentUser.referralBonus);
                const bonusReward = Math.floor(task.reward * (1 + userLevel.bonus));
                
                const categoryColors = {
                    social: 'from-pink-400 to-red-500',
                    survey: 'from-green-400 to-blue-500',
                    download: 'from-purple-400 to-indigo-500',
                    review: 'from-yellow-400 to-orange-500',
                    other: 'from-gray-400 to-gray-600'
                };
                
                const difficultyIcons = {
                    easy: 'â­',
                    medium: 'â­â­',
                    hard: 'â­â­â­'
                };
                
                const taskEl = document.createElement('div');
                taskEl.className = `bg-gradient-to-br ${categoryColors[task.category] || 'from-blue-400 to-purple-500'} rounded-2xl p-6 text-white shadow-2xl transform hover:scale-105 transition-all`;
                taskEl.innerHTML = `
                    <div class="mb-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-xl">${task.title}</h4>
                            <span class="text-sm bg-white bg-opacity-20 px-2 py-1 rounded-lg">${difficultyIcons[task.difficulty] || 'â­'}</span>
                        </div>
                        <div class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded-lg inline-block mb-2">${task.category?.toUpperCase() || 'OTHER'}</div>
                        <p class="text-blue-100 mb-3">${task.description}</p>
                        <div class="flex justify-between items-center mb-2">
                            <span class="bg-white bg-opacity-20 px-3 py-1 rounded-xl font-bold">
                                ğŸ’° ${bonusReward} coins ${userLevel.bonus > 0 ? `(+${(userLevel.bonus * 100).toFixed(0)}% bonus)` : ''}
                            </span>
                            ${task.link ? `<a href="${task.link}" target="_blank" rel="noopener noreferrer" class="bg-white bg-opacity-20 px-3 py-1 rounded-xl text-sm hover:bg-opacity-30 transition-colors">ğŸ”— Visit Link</a>` : ''}
                        </div>
                        ${task.limit ? `<div class="text-center text-sm bg-white bg-opacity-20 rounded-xl py-1">ğŸ‘¥ ${completedCount}/${task.limit} completed</div>` : ''}
                    </div>
                    <button onclick="submitTask(${task.id})" 
                            class="w-full py-3 rounded-xl font-bold transition-all ${
                                isCompleted ? 'bg-green-500 text-white cursor-not-allowed' : 
                                hasPendingSubmission ? 'bg-yellow-500 text-white cursor-not-allowed' :
                                isTaskFull ? 'bg-red-500 text-white cursor-not-allowed' :
                                'bg-white text-purple-500 hover:bg-gray-100'
                            }"
                            ${isCompleted || hasPendingSubmission || isTaskFull ? 'disabled' : ''}>
                        ${isCompleted ? 'âœ… Completed' : hasPendingSubmission ? 'â³ Pending Review' : isTaskFull ? 'ğŸš« Task Full' : 'ğŸ“¤ Submit Proof'}
                    </button>
                `;
                tasksList.appendChild(taskEl);
            });
        }
        
        // Update transaction history
        function updateTransactionHistory() {
            const historyEl = document.getElementById('transactionHistory');
            historyEl.innerHTML = '';
            
            if (currentUser.transactions.length === 0) {
                historyEl.innerHTML = '<p class="text-gray-500 text-center py-4">No transactions yet</p>';
                return;
            }
            
            currentUser.transactions.slice(-10).reverse().forEach(transaction => {
                const transactionEl = document.createElement('div');
                transactionEl.className = `flex justify-between items-center p-4 rounded-xl ${
                    transaction.type === 'task' ? 'bg-blue-100' : 
                    transaction.type === 'referral' ? 'bg-green-100' : 'bg-gray-100'
                }`;
                transactionEl.innerHTML = `
                    <div>
                        <div class="font-medium text-gray-800">${transaction.description}</div>
                        <div class="text-sm text-gray-600">${transaction.timestamp}</div>
                    </div>
                    <div class="font-bold ${transaction.amount > 0 ? 'text-green-600' : 'text-red-600'}">
                        ${transaction.amount > 0 ? '+' : ''}${transaction.amount} coins
                    </div>
                `;
                historyEl.appendChild(transactionEl);
            });
        }
        
        // Submit task
        function submitTask(taskId) {
            document.getElementById('submissionTaskId').value = taskId;
            document.getElementById('taskSubmissionModal').classList.remove('hidden');
        }
        
        // Task submission form
        document.getElementById('taskSubmissionForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const taskId = parseInt(document.getElementById('submissionTaskId').value);
            const file = document.getElementById('proofFile').files[0];
            const description = document.getElementById('proofDescription').value;
            
            // Check file size (3MB limit)
            if (file && file.size > 3 * 1024 * 1024) {
                showNotification('File size must be less than 3MB', 'error');
                return;
            }
            
            // Convert file to base64 for storage
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const submission = {
                        id: Date.now(),
                        taskId,
                        username: currentUser.username,
                        description,
                        fileName: file.name,
                        fileSize: file.size,
                        fileType: file.type,
                        fileData: e.target.result, // Base64 data
                        timestamp: new Date().toLocaleString(),
                        status: 'pending'
                    };
                    
                    taskSubmissions.push(submission);
                    saveData();
                    
                    document.getElementById('taskSubmissionModal').classList.add('hidden');
                    document.getElementById('taskSubmissionForm').reset();
                    updateTasksList();
                    showNotification('Task proof submitted! Waiting for admin approval.', 'success');
                };
                reader.readAsDataURL(file);
            } else {
                const submission = {
                    id: Date.now(),
                    taskId,
                    username: currentUser.username,
                    description,
                    fileName: null,
                    fileSize: null,
                    fileType: null,
                    fileData: null,
                    timestamp: new Date().toLocaleString(),
                    status: 'pending'
                };
                
                taskSubmissions.push(submission);
                saveData();
                
                document.getElementById('taskSubmissionModal').classList.add('hidden');
                document.getElementById('taskSubmissionForm').reset();
                updateTasksList();
                showNotification('Task proof submitted! Waiting for admin approval.', 'success');
            }
        });
        
        // Cancel task submission
        document.getElementById('cancelSubmission').addEventListener('click', () => {
            document.getElementById('taskSubmissionModal').classList.add('hidden');
            document.getElementById('taskSubmissionForm').reset();
        });
        
        // Copy referral code
        document.getElementById('copyReferralBtn').addEventListener('click', () => {
            const referralInput = document.getElementById('myReferralCode');
            referralInput.select();
            document.execCommand('copy');
            
            const btn = document.getElementById('copyReferralBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'âœ… Copied!';
            btn.className = 'bg-green-500 text-white px-4 py-2 rounded-r-xl transition-colors font-bold';
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.className = 'bg-white text-purple-500 px-4 py-2 rounded-r-xl hover:bg-gray-100 transition-colors font-bold';
            }, 2000);
        });
        
        // Promo code form
        document.getElementById('promoCodeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const code = document.getElementById('promoCodeInput').value.trim().toUpperCase();
            
            const promo = promoCodes.find(p => p.code === code && p.active && p.usedBy.length < p.limit);
            
            if (!promo) {
                showNotification('Invalid or expired promo code', 'error');
                return;
            }
            
            if (promo.usedBy.includes(currentUser.username)) {
                showNotification('You have already used this promo code', 'error');
                return;
            }
            
            // Apply promo code
            promo.usedBy.push(currentUser.username);
            currentUser.referralBonus += promo.reward;
            currentUser.transactions.push({
                type: 'promo',
                amount: promo.reward,
                description: `Promo code: ${promo.name}`,
                timestamp: new Date().toLocaleString()
            });
            
            saveData();
            updateUserDashboard();
            document.getElementById('promoCodeInput').value = '';
            showNotification(`Promo code redeemed! +${promo.reward} coins`, 'success');
        });
        
        // Task filter
        document.getElementById('taskFilter').addEventListener('change', () => {
            updateTasksList();
        });
        
        // Toggle FAQ
        function toggleFAQ(faqId) {
            const answer = document.getElementById(`faq-answer-${faqId}`);
            const icon = document.getElementById(`faq-icon-${faqId}`);
            
            if (answer.classList.contains('hidden')) {
                answer.classList.remove('hidden');
                icon.textContent = 'â–²';
            } else {
                answer.classList.add('hidden');
                icon.textContent = 'â–¼';
            }
        }
        
        // Message admin form
        document.getElementById('messageAdminForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const subject = document.getElementById('messageSubject').value;
            const content = document.getElementById('messageContent').value;
            
            const message = {
                id: Date.now(),
                username: currentUser.username,
                subject,
                content,
                timestamp: new Date().toLocaleString(),
                replied: false
            };
            
            messages.push(message);
            saveData();
            
            document.getElementById('messageAdminForm').reset();
            showNotification('Message sent to admin successfully!', 'success');
        });

        // Update admin replies
        function updateAdminReplies() {
            const repliesList = document.getElementById('adminRepliesList');
            repliesList.innerHTML = '';
            
            const userReplies = adminReplies.filter(reply => reply.toUsername === currentUser.username);
            
            if (userReplies.length === 0) {
                repliesList.innerHTML = '<p class="text-gray-500 text-center py-4">No replies from admin yet</p>';
                return;
            }
            
            userReplies.forEach(reply => {
                const replyEl = document.createElement('div');
                replyEl.className = 'bg-blue-50 border border-blue-200 p-4 rounded-xl';
                replyEl.innerHTML = `
                    <div class="font-bold text-gray-800 mb-2">Re: ${reply.subject}</div>
                    <div class="text-gray-700 mb-2">${reply.content}</div>
                    <div class="text-xs text-gray-500">${reply.timestamp}</div>
                `;
                repliesList.appendChild(replyEl);
            });
        }

        // Withdrawal
        document.getElementById('withdrawBtn').addEventListener('click', () => {
            const totalBalance = currentUser.taskEarnings + currentUser.referralBonus;
            if (totalBalance < minWithdrawal) {
                showNotification(`Minimum withdrawal is ${minWithdrawal} coins`, 'error');
                return;
            }
            document.getElementById('withdrawalModal').classList.remove('hidden');
        });
        
        document.getElementById('cancelWithdrawal').addEventListener('click', () => {
            document.getElementById('withdrawalModal').classList.add('hidden');
            document.getElementById('withdrawalForm').reset();
        });
        
        document.getElementById('withdrawalForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bankName = document.getElementById('bankName').value;
            const accountName = document.getElementById('accountName').value;
            const accountNumber = document.getElementById('accountNumber').value;
            
            const totalBalance = currentUser.taskEarnings + currentUser.referralBonus;
            
            if (amount < minWithdrawal) {
                showNotification(`Minimum withdrawal is ${minWithdrawal} coins`, 'error');
                return;
            }
            
            if (amount > totalBalance) {
                showNotification('Insufficient balance!', 'error');
                return;
            }
            
            // Create withdrawal request
            const request = {
                id: Date.now(),
                username: currentUser.username,
                amount,
                bankName,
                accountName,
                accountNumber,
                timestamp: new Date().toLocaleString(),
                status: 'pending'
            };
            
            withdrawalRequests.push(request);
            saveData();
            
            document.getElementById('withdrawalModal').classList.add('hidden');
            document.getElementById('withdrawalForm').reset();
            
            showNotification('Withdrawal request submitted! Waiting for admin approval.', 'success');
        });
        
        // Admin functions
        function updateAdminDashboard() {
            document.getElementById('totalSignups').textContent = Object.keys(users).length;
            document.getElementById('blockedUsers').textContent = blockedUsers.length;
            document.getElementById('pendingTasks').textContent = taskSubmissions.filter(sub => sub.status === 'pending').length;
            document.getElementById('minWithdrawalInput').value = minWithdrawal;
            
            // Update analytics
            const today = new Date().toDateString();
            const todaySignups = Object.values(users).filter(user => 
                new Date(user.signupDate).toDateString() === today
            ).length;
            document.getElementById('todaySignups').textContent = todaySignups;
            
            const activeUsers = Object.values(users).filter(user => {
                const lastOnline = new Date(user.lastOnline);
                const daysSinceOnline = (Date.now() - lastOnline.getTime()) / (1000 * 60 * 60 * 24);
                return daysSinceOnline <= 7; // Active in last 7 days
            }).length;
            document.getElementById('activeUsers').textContent = activeUsers;
            
            const totalEarnings = Object.values(users).reduce((sum, user) => 
                sum + user.taskEarnings + user.referralBonus, 0
            );
            document.getElementById('totalEarnings').textContent = totalEarnings;
            
            // Update withdrawal toggle
            const toggleBtn = document.getElementById('toggleWithdrawal');
            if (withdrawalOpen) {
                toggleBtn.textContent = 'ğŸŸ¢ Open';
                toggleBtn.className = 'bg-green-500 text-white px-4 py-2 rounded-xl hover:bg-green-600 transition-colors font-bold';
            } else {
                toggleBtn.textContent = 'ğŸ”´ Closed';
                toggleBtn.className = 'bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition-colors font-bold';
            }
            
            updateAdminNewsList();
            updatePendingApprovals();
            updateAllUsersList();
            updateUserMessages();
            updateActivePromoCodes();
            updateFAQList();
        }
        
        // Update active promo codes
        function updateActivePromoCodes() {
            const promoList = document.getElementById('activePromoCodes');
            promoList.innerHTML = '';
            
            const activePromos = promoCodes.filter(promo => promo.active);
            
            if (activePromos.length === 0) {
                promoList.innerHTML = '<p class="text-gray-500 text-center py-4">No active promo codes</p>';
                return;
            }
            
            activePromos.forEach(promo => {
                const promoEl = document.createElement('div');
                promoEl.className = 'bg-yellow-50 border border-yellow-200 p-4 rounded-xl';
                promoEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-bold text-gray-800">${promo.name}</div>
                            <div class="text-sm text-gray-600">Code: <span class="font-mono bg-gray-100 px-2 py-1 rounded">${promo.code}</span></div>
                            <div class="text-sm text-gray-600">Reward: ${promo.reward} coins | Used: ${promo.usedBy.length}/${promo.limit}</div>
                            <div class="text-xs text-gray-500">Created: ${promo.createdAt}</div>
                        </div>
                        <button onclick="deactivatePromo(${promo.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors ml-3">Deactivate</button>
                    </div>
                `;
                promoList.appendChild(promoEl);
            });
        }
        
        // Update FAQ list
        function updateFAQList() {
            const faqList = document.getElementById('faqList');
            faqList.innerHTML = '';
            
            if (faqItems.length === 0) {
                faqList.innerHTML = '<p class="text-gray-500 text-center py-4">No FAQ items</p>';
                return;
            }
            
            faqItems.forEach(faq => {
                const faqEl = document.createElement('div');
                faqEl.className = 'bg-purple-50 border border-purple-200 p-4 rounded-xl';
                faqEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-bold text-gray-800">${faq.question}</div>
                            <div class="text-sm text-gray-600 mt-1">${faq.answer}</div>
                            <div class="text-xs text-gray-500 mt-2">Created: ${faq.createdAt}</div>
                        </div>
                        <button onclick="removeFAQ(${faq.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors ml-3">Delete</button>
                    </div>
                `;
                faqList.appendChild(faqEl);
            });
        }
        
        // Toggle withdrawal portal
        document.getElementById('toggleWithdrawal').addEventListener('click', () => {
            withdrawalOpen = !withdrawalOpen;
            saveData();
            updateAdminDashboard();
            showNotification(`Withdrawal portal ${withdrawalOpen ? 'opened' : 'closed'}`, 'success');
        });
        
        // Update minimum withdrawal
        document.getElementById('updateMinWithdrawal').addEventListener('click', () => {
            const newMin = parseInt(document.getElementById('minWithdrawalInput').value);
            if (newMin && newMin > 0) {
                minWithdrawal = newMin;
                saveData();
                showNotification('Minimum withdrawal updated', 'success');
            }
        });
        
        // Block user
        document.getElementById('blockUserBtn').addEventListener('click', () => {
            const username = document.getElementById('blockUsername').value.trim();
            if (username && users[username] && !blockedUsers.includes(username)) {
                blockedUsers.push(username);
                saveData();
                document.getElementById('blockUsername').value = '';
                updateAdminDashboard();
                showNotification(`User ${username} blocked`, 'success');
            } else {
                showNotification('Invalid username or user already blocked', 'error');
            }
        });
        
        // Remove coins from user
        document.getElementById('removeCoinBtn').addEventListener('click', () => {
            const username = document.getElementById('coinUsername').value.trim();
            const amount = parseInt(document.getElementById('coinAmount').value);
            
            if (!username || !users[username]) {
                showNotification('Invalid username', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showNotification('Invalid amount', 'error');
                return;
            }
            
            const user = users[username];
            const totalBalance = user.taskEarnings + user.referralBonus;
            
            if (amount > totalBalance) {
                showNotification('Amount exceeds user balance', 'error');
                return;
            }
            
            // Remove from appropriate balances
            let remaining = amount;
            if (user.taskEarnings >= remaining) {
                user.taskEarnings -= remaining;
            } else {
                remaining -= user.taskEarnings;
                user.taskEarnings = 0;
                user.referralBonus -= remaining;
            }
            
            user.transactions.push({
                type: 'admin_deduction',
                amount: -amount,
                description: 'Admin coin deduction',
                timestamp: new Date().toLocaleString()
            });
            
            saveData();
            document.getElementById('coinUsername').value = '';
            document.getElementById('coinAmount').value = '';
            updateAllUsersList();
            showNotification(`${amount} coins removed from ${username}`, 'success');
        });
        
        // Add coins to user
        document.getElementById('addCoinBtn').addEventListener('click', () => {
            const username = document.getElementById('addCoinUsername').value.trim();
            const amount = parseInt(document.getElementById('addCoinAmount').value);
            
            if (!username || !users[username]) {
                showNotification('Invalid username', 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                showNotification('Invalid amount', 'error');
                return;
            }
            
            const user = users[username];
            user.referralBonus += amount; // Add to referral bonus
            
            user.transactions.push({
                type: 'admin_bonus',
                amount: amount,
                description: 'Admin coin bonus',
                timestamp: new Date().toLocaleString()
            });
            
            saveData();
            document.getElementById('addCoinUsername').value = '';
            document.getElementById('addCoinAmount').value = '';
            updateAllUsersList();
            showNotification(`${amount} coins added to ${username}`, 'success');
        });
        
        // Approve all tasks
        document.getElementById('approveAllTasksBtn').addEventListener('click', () => {
            const pendingSubmissions = taskSubmissions.filter(sub => sub.status === 'pending');
            
            if (pendingSubmissions.length === 0) {
                showNotification('No pending tasks to approve', 'error');
                return;
            }
            
            let approvedCount = 0;
            
            pendingSubmissions.forEach(submission => {
                const task = tasks.find(t => t.id === submission.taskId);
                const user = users[submission.username];
                
                if (task && user) {
                    submission.status = 'approved';
                    
                    // Calculate reward with level bonus
                    const userLevel = getUserLevel(user.taskEarnings + user.referralBonus);
                    const bonusReward = Math.floor(task.reward * (1 + userLevel.bonus));
                    
                    user.taskEarnings += bonusReward;
                    user.completedTasks.push(task.id);
                    user.transactions.push({
                        type: 'task',
                        amount: bonusReward,
                        description: `Task completed: ${task.title}`,
                        timestamp: new Date().toLocaleString()
                    });
                    task.completions++;
                    
                    // Check achievements
                    checkAchievement(user.username, 'first_task');
                    checkAchievement(user.username, 'task_master_10');
                    checkAchievement(user.username, 'task_master_50');
                    checkAchievement(user.username, 'big_earner');
                    
                    approvedCount++;
                }
            });
            
            saveData();
            updatePendingApprovals();
            updateAdminDashboard();
            showNotification(`${approvedCount} tasks approved successfully!`, 'success');
        });
        
        // Create promo code
        document.getElementById('createPromoBtn').addEventListener('click', () => {
            const name = document.getElementById('promoCodeName').value.trim();
            const reward = parseInt(document.getElementById('promoCodeReward').value);
            const limit = parseInt(document.getElementById('promoCodeLimit').value);
            
            if (!name || !reward || !limit) {
                showNotification('Please fill all fields', 'error');
                return;
            }
            
            const promoCode = {
                id: Date.now(),
                code: generatePromoCode(),
                name,
                reward,
                limit,
                usedBy: [],
                active: true,
                createdAt: new Date().toLocaleString()
            };
            
            promoCodes.push(promoCode);
            saveData();
            
            document.getElementById('promoCodeName').value = '';
            document.getElementById('promoCodeReward').value = '';
            document.getElementById('promoCodeLimit').value = '';
            
            updateActivePromoCodes();
            showNotification(`Promo code created: ${promoCode.code}`, 'success');
        });
        
        // Add FAQ
        document.getElementById('addFaqForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const question = document.getElementById('faqQuestion').value.trim();
            const answer = document.getElementById('faqAnswer').value.trim();
            
            const faqItem = {
                id: Date.now(),
                question,
                answer,
                createdAt: new Date().toLocaleString()
            };
            
            faqItems.push(faqItem);
            saveData();
            
            document.getElementById('addFaqForm').reset();
            updateFAQList();
            showNotification('FAQ item added successfully', 'success');
        });
        
        // View users
        document.getElementById('viewUsersBtn').addEventListener('click', () => {
            let userList = 'Registered Users:\n\n';
            Object.values(users).forEach(user => {
                const status = blockedUsers.includes(user.username) ? ' (BLOCKED)' : '';
                userList += `Username: ${user.username}${status}\nPhone: ${user.phone}\nBalance: ${user.taskEarnings + user.referralBonus} coins\nJoined: ${new Date(user.signupDate).toLocaleDateString()}\n\n`;
            });
            alert(userList);
        });
        
        // Add news
        document.getElementById('addNewsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('newsTitle').value;
            const content = document.getElementById('newsContent').value;
            const duration = parseInt(document.getElementById('newsDuration').value);
            
            const newsItem = {
                id: Date.now(),
                title,
                content,
                duration,
                timestamp: new Date().toISOString()
            };
            
            news.push(newsItem);
            saveData();
            updateAdminNewsList();
            document.getElementById('addNewsForm').reset();
            showNotification('News posted successfully', 'success');
        });
        
        // Update admin news list
        function updateAdminNewsList() {
            const list = document.getElementById('adminNewsList');
            list.innerHTML = '';
            
            news.forEach(item => {
                const expiryTime = new Date(item.timestamp).getTime() + (item.duration * 60 * 60 * 1000);
                const isActive = Date.now() < expiryTime;
                
                const newsEl = document.createElement('div');
                newsEl.className = `p-4 rounded-xl border ${isActive ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`;
                newsEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-bold text-gray-800">${item.title}</div>
                            <div class="text-sm text-gray-600 mt-1">${item.content}</div>
                            <div class="text-xs text-gray-500 mt-2">
                                Posted: ${new Date(item.timestamp).toLocaleString()} | 
                                Duration: ${item.duration}h | 
                                Status: ${isActive ? 'ğŸŸ¢ Active' : 'ğŸ”´ Expired'}
                            </div>
                        </div>
                        <button onclick="removeNews(${item.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors ml-3">Delete</button>
                    </div>
                `;
                list.appendChild(newsEl);
            });
        }
        
        // Remove news
        function removeNews(newsId) {
            news = news.filter(item => item.id !== newsId);
            saveData();
            updateAdminNewsList();
            showNotification('News deleted', 'success');
        }
        
        // Add task
        document.getElementById('addTaskForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('taskTitle').value;
            const description = document.getElementById('taskDescription').value;
            const reward = parseInt(document.getElementById('taskReward').value);
            const limit = parseInt(document.getElementById('taskLimit').value);
            const category = document.getElementById('taskCategory').value;
            const difficulty = document.getElementById('taskDifficulty').value;
            const link = document.getElementById('taskLink').value;
            
            const task = {
                id: Date.now(),
                title,
                description,
                reward,
                limit,
                category,
                difficulty,
                link: link || null,
                completions: 0,
                createdAt: new Date().toLocaleString()
            };
            
            tasks.push(task);
            saveData();
            document.getElementById('addTaskForm').reset();
            showNotification('Task added successfully', 'success');
        });
        
        // Update pending approvals
        function updatePendingApprovals() {
            // Task submissions
            const taskSubmissionsList = document.getElementById('pendingTaskSubmissions');
            taskSubmissionsList.innerHTML = '';
            
            const pendingSubmissions = taskSubmissions.filter(sub => sub.status === 'pending');
            
            if (pendingSubmissions.length === 0) {
                taskSubmissionsList.innerHTML = '<p class="text-gray-500 text-center py-4">No pending task submissions</p>';
            } else {
                pendingSubmissions.forEach(submission => {
                    const task = tasks.find(t => t.id === submission.taskId);
                    const submissionEl = document.createElement('div');
                    submissionEl.className = 'bg-yellow-50 border border-yellow-200 p-4 rounded-xl';
                    submissionEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-bold text-gray-800">${task ? task.title : 'Unknown Task'}</div>
                                <div class="text-sm text-gray-600">User: ${submission.username}</div>
                                <div class="text-sm text-gray-600">Description: ${submission.description}</div>
                                <div class="text-sm text-gray-600">File: ${submission.fileName || 'No file'}</div>
                                <div class="text-xs text-gray-500">Submitted: ${submission.timestamp}</div>
                                ${submission.fileData && submission.fileType && submission.fileType.startsWith('image/') ? 
                                    `<button onclick="viewImage('${submission.fileData}', '${submission.fileName}', '${submission.username}', '${task ? task.title : 'Unknown Task'}')" class="mt-2 bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">ğŸ‘ï¸ View Image</button>` : ''}
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="approveTask(${submission.id})" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">âœ… Approve</button>
                                <button onclick="rejectTask(${submission.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">âŒ Reject</button>
                            </div>
                        </div>
                    `;
                    taskSubmissionsList.appendChild(submissionEl);
                });
            }
            
            // Withdrawal requests
            const withdrawalsList = document.getElementById('pendingWithdrawals');
            withdrawalsList.innerHTML = '';
            
            const pendingWithdrawals = withdrawalRequests.filter(req => req.status === 'pending');
            
            if (pendingWithdrawals.length === 0) {
                withdrawalsList.innerHTML = '<p class="text-gray-500 text-center py-4">No pending withdrawals</p>';
            } else {
                pendingWithdrawals.forEach(request => {
                    const requestEl = document.createElement('div');
                    requestEl.className = 'bg-blue-50 border border-blue-200 p-4 rounded-xl';
                    requestEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-bold text-gray-800">${request.username} - ${request.amount} coins</div>
                                <div class="text-sm text-gray-600">Bank: ${request.bankName}</div>
                                <div class="text-sm text-gray-600">Account: ${request.accountName} - ${request.accountNumber}</div>
                                <div class="text-xs text-gray-500">Requested: ${request.timestamp}</div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="approveWithdrawal(${request.id})" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">âœ… Approve</button>
                                <button onclick="rejectWithdrawal(${request.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">âŒ Reject</button>
                            </div>
                        </div>
                    `;
                    withdrawalsList.appendChild(requestEl);
                });
            }
        }
        
        // Approve task
        function approveTask(submissionId) {
            const submission = taskSubmissions.find(sub => sub.id === submissionId);
            const task = tasks.find(t => t.id === submission.taskId);
            const user = users[submission.username];
            
            if (submission && task && user) {
                submission.status = 'approved';
                user.taskEarnings += task.reward;
                user.completedTasks.push(task.id);
                user.transactions.push({
                    type: 'task',
                    amount: task.reward,
                    description: `Task completed: ${task.title}`,
                    timestamp: new Date().toLocaleString()
                });
                task.completions++;
                
                saveData();
                updatePendingApprovals();
                showNotification(`Task approved for ${submission.username}`, 'success');
            }
        }
        
        // Reject task
        function rejectTask(submissionId) {
            const submission = taskSubmissions.find(sub => sub.id === submissionId);
            if (submission) {
                submission.status = 'rejected';
                saveData();
                updatePendingApprovals();
                showNotification(`Task rejected for ${submission.username}`, 'success');
            }
        }
        
        // Approve withdrawal
        function approveWithdrawal(requestId) {
            const request = withdrawalRequests.find(req => req.id === requestId);
            const user = users[request.username];
            
            if (request && user) {
                const totalBalance = user.taskEarnings + user.referralBonus;
                if (totalBalance >= request.amount) {
                    // Deduct from appropriate balances
                    let remaining = request.amount;
                    if (user.taskEarnings >= remaining) {
                        user.taskEarnings -= remaining;
                    } else {
                        remaining -= user.taskEarnings;
                        user.taskEarnings = 0;
                        user.referralBonus -= remaining;
                    }
                    
                    request.status = 'approved';
                    user.transactions.push({
                        type: 'withdrawal',
                        amount: -request.amount,
                        description: `Withdrawal to ${request.bankName}`,
                        timestamp: new Date().toLocaleString()
                    });
                    
                    saveData();
                    updatePendingApprovals();
                    showNotification(`Withdrawal approved for ${request.username}`, 'success');
                } else {
                    showNotification('User has insufficient balance', 'error');
                }
            }
        }
        
        // Reject withdrawal
        function rejectWithdrawal(requestId) {
            const request = withdrawalRequests.find(req => req.id === requestId);
            if (request) {
                request.status = 'rejected';
                saveData();
                updatePendingApprovals();
                showNotification(`Withdrawal rejected for ${request.username}`, 'success');
            }
        }
        
        // Logout functions
        document.getElementById('logoutBtn').addEventListener('click', () => {
            currentUser = null;
            document.getElementById('userDashboard').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
        });
        
        document.getElementById('adminLogoutBtn').addEventListener('click', () => {
            currentUser = null;
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('authPage').classList.remove('hidden');
        });
        
        // Update all users list
        function updateAllUsersList() {
            const usersList = document.getElementById('allUsersList');
            usersList.innerHTML = '';
            
            Object.values(users).forEach(user => {
                const isBlocked = blockedUsers.includes(user.username);
                const lastOnline = user.lastOnline ? new Date(user.lastOnline).toLocaleString() : 'Never';
                const totalBalance = user.taskEarnings + user.referralBonus;
                
                const userEl = document.createElement('div');
                userEl.className = `p-4 rounded-xl border ${isBlocked ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200'}`;
                userEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-bold text-gray-800">${user.username} ${isBlocked ? '(BLOCKED)' : ''}</div>
                            <div class="text-sm text-gray-600">Phone: ${user.phone}</div>
                            <div class="text-sm text-gray-600">Balance: ${totalBalance} coins</div>
                            <div class="text-sm text-gray-600">Referral Code: ${user.referralCode}</div>
                            <div class="text-sm text-gray-600">Last Online: ${lastOnline}</div>
                            <div class="text-xs text-gray-500">Joined: ${new Date(user.signupDate).toLocaleDateString()}</div>
                        </div>
                        <div class="flex flex-col space-y-2 ml-4">
                            ${!isBlocked ? 
                                `<button onclick="blockUser('${user.username}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">ğŸš« Block</button>` :
                                `<button onclick="unblockUser('${user.username}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">âœ… Unblock</button>`
                            }
                        </div>
                    </div>
                `;
                usersList.appendChild(userEl);
            });
        }

        // Update user messages
        function updateUserMessages() {
            const messagesList = document.getElementById('userMessagesList');
            messagesList.innerHTML = '';
            
            if (messages.length === 0) {
                messagesList.innerHTML = '<p class="text-gray-500 text-center py-4">No messages from users</p>';
                return;
            }
            
            messages.slice().reverse().forEach(message => {
                const messageEl = document.createElement('div');
                messageEl.className = `p-4 rounded-xl border ${message.replied ? 'bg-green-50 border-green-200' : 'bg-yellow-50 border-yellow-200'}`;
                messageEl.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="font-bold text-gray-800">${message.subject}</div>
                            <div class="text-sm text-gray-600 mb-2">From: ${message.username}</div>
                            <div class="text-gray-700 mb-2">${message.content}</div>
                            <div class="text-xs text-gray-500">${message.timestamp}</div>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            ${!message.replied ? 
                                `<button onclick="replyToMessage(${message.id}, '${message.username}', '${message.subject}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">ğŸ’¬ Reply</button>` :
                                `<span class="text-green-600 text-sm font-bold">âœ… Replied</span>`
                            }
                        </div>
                    </div>
                `;
                messagesList.appendChild(messageEl);
            });
        }

        // View image function
        function viewImage(imageData, fileName, username, taskTitle) {
            document.getElementById('proofImage').src = imageData;
            document.getElementById('imageDetails').innerHTML = `
                <div class="text-left">
                    <p><strong>File:</strong> ${fileName}</p>
                    <p><strong>User:</strong> ${username}</p>
                    <p><strong>Task:</strong> ${taskTitle}</p>
                </div>
            `;
            document.getElementById('imageViewerModal').classList.remove('hidden');
        }

        // Close image viewer
        document.getElementById('closeImageViewer').addEventListener('click', () => {
            document.getElementById('imageViewerModal').classList.add('hidden');
        });

        // Block/Unblock user functions
        function blockUser(username) {
            if (!blockedUsers.includes(username)) {
                blockedUsers.push(username);
                saveData();
                updateAllUsersList();
                updateAdminDashboard();
                showNotification(`User ${username} blocked`, 'success');
            }
        }

        function unblockUser(username) {
            const index = blockedUsers.indexOf(username);
            if (index > -1) {
                blockedUsers.splice(index, 1);
                saveData();
                updateAllUsersList();
                updateAdminDashboard();
                showNotification(`User ${username} unblocked`, 'success');
            }
        }

        // Reply to message
        function replyToMessage(messageId, username, subject) {
            document.getElementById('replyToUsername').value = username;
            document.getElementById('replyToMessageId').value = messageId;
            document.getElementById('replySubject').value = subject;
            document.getElementById('replyModal').classList.remove('hidden');
        }

        // Reply form submission
        document.getElementById('replyForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const toUsername = document.getElementById('replyToUsername').value;
            const messageId = parseInt(document.getElementById('replyToMessageId').value);
            const subject = document.getElementById('replySubject').value;
            const content = document.getElementById('replyContent').value;
            
            const reply = {
                id: Date.now(),
                toUsername,
                subject,
                content,
                timestamp: new Date().toLocaleString()
            };
            
            adminReplies.push(reply);
            
            // Mark original message as replied
            const originalMessage = messages.find(msg => msg.id === messageId);
            if (originalMessage) {
                originalMessage.replied = true;
            }
            
            saveData();
            
            document.getElementById('replyModal').classList.add('hidden');
            document.getElementById('replyForm').reset();
            updateUserMessages();
            showNotification('Reply sent successfully!', 'success');
        });

        // Cancel reply
        document.getElementById('cancelReply').addEventListener('click', () => {
            document.getElementById('replyModal').classList.add('hidden');
            document.getElementById('replyForm').reset();
        });

        // Deactivate promo code
        function deactivatePromo(promoId) {
            const promo = promoCodes.find(p => p.id === promoId);
            if (promo) {
                promo.active = false;
                saveData();
                updateActivePromoCodes();
                showNotification('Promo code deactivated', 'success');
            }
        }
        
        // Remove FAQ
        function removeFAQ(faqId) {
            const index = faqItems.findIndex(faq => faq.id === faqId);
            if (index > -1) {
                faqItems.splice(index, 1);
                saveData();
                updateFAQList();
                updateFAQSection();
                showNotification('FAQ item removed', 'success');
            }
        }
        
        // Make functions global for onclick handlers
        window.submitTask = submitTask;
        window.removeNews = removeNews;
        window.approveTask = approveTask;
        window.rejectTask = rejectTask;
        window.approveWithdrawal = approveWithdrawal;
        window.rejectWithdrawal = rejectWithdrawal;
        window.viewImage = viewImage;
        window.blockUser = blockUser;
        window.unblockUser = unblockUser;
        window.replyToMessage = replyToMessage;
        window.toggleFAQ = toggleFAQ;
        window.deactivatePromo = deactivatePromo;
        window.removeFAQ = removeFAQ;
        
        // Clean up expired news on load
        news = news.filter(item => {
            const expiryTime = new Date(item.timestamp).getTime() + (item.duration * 60 * 60 * 1000);
            return Date.now() < expiryTime;
        });
        saveData();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'995e55728330becb',t:'MTc2MTY5NTQwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
