<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uthman Task Earn - Earning Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-gradient {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .success-gradient {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .warning-gradient {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .coin-animation {
            animation: coinBounce 0.6s ease-out;
        }
        @keyframes coinBounce {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .notification-slide {
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="gradient-bg min-h-full">
    
    <div id="telegramPopup" class="fixed top-4 right-4 z-50 bg-gradient-to-r from-blue-500 to-cyan-500 text-white p-4 rounded-2xl shadow-2xl max-w-sm notification-slide">
        <div class="flex items-center space-x-3">
            <div class="text-2xl">ğŸ“±</div>
            <div class="flex-1">
                <div class="font-bold">Join Our Telegram!</div>
                <div class="text-xs text-blue-100">Get updates & exclusive offers</div>
            </div>
            <div class="flex space-x-2">
                <button id="joinTelegram" class="bg-white text-blue-500 px-3 py-1 rounded-lg text-sm font-bold hover:bg-gray-100 transition-colors">Join</button>
                <button id="closeTelegramPopup" class="text-white hover:text-gray-200 transition-colors">âœ•</button>
            </div>
        </div>
    </div>

    <div id="telegramFloat" class="fixed bottom-6 right-6 z-40">
        <button id="telegramBtn" class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white p-4 rounded-full shadow-2xl hover:scale-110 transition-all pulse-animation">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.568 8.16l-1.61 7.59c-.12.54-.44.67-.89.42l-2.46-1.82-1.19 1.14c-.13.13-.24.24-.49.24l.17-2.43 4.47-4.03c.19-.17-.04-.27-.3-.1L9.28 13.47l-2.38-.75c-.52-.16-.53-.52.11-.77l9.3-3.58c.43-.16.81.1.67.73z"/>
            </svg>
        </button>
    </div>

    <div id="authPage" class="min-h-full flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 w-full max-w-md border-4 border-purple-200">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ’°</div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">Uthman Task Earn</h1>
                <p class="text-gray-600 font-medium">Complete Tasks & Earn Money</p>
            </div>
            
            <div class="mb-6">
                <div class="flex bg-gradient-to-r from-purple-100 to-pink-100 rounded-2xl p-1">
                    <button id="loginTab" class="flex-1 py-3 px-4 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold transition-all shadow-lg">Login</button>
                    <button id="signupTab" class="flex-1 py-3 px-4 rounded-xl text-purple-600 font-bold transition-all">Sign Up</button>
                </div>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginUsername" class="block text-sm font-bold text-gray-700 mb-2">ğŸ‘¤ Username</label>
                    <input type="text" id="loginUsername" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Enter username" required>
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-bold text-gray-700 mb-2">ğŸ”’ Password</label>
                    <input type="password" id="loginPassword" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Enter password" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-bold hover:from-purple-600 hover:to-pink-600 transition-all shadow-lg transform hover:scale-105">ğŸš€ Login</button>
            </form>
            
            <form id="signupForm" class="space-y-4 hidden">
                <div>
                    <label for="signupUsername" class="block text-sm font-bold text-gray-700 mb-2">ğŸ‘¤ Username</label>
                    <input type="text" id="signupUsername" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Choose unique username" required minlength="3" maxlength="20">
                </div>
                <div>
                    <label for="signupCountryCode" class="block text-sm font-bold text-gray-700 mb-2">ğŸŒ Country Code</label>
                    <select id="signupCountryCode" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" required>
                        <option value="">Select Country</option>
                        <option value="+1">ğŸ‡ºğŸ‡¸ United States (+1)</option>
                        <option value="+44">ğŸ‡¬ğŸ‡§ United Kingdom (+44)</option>
                        <option value="+91">ğŸ‡®ğŸ‡³ India (+91)</option>
                        <option value="+234">ğŸ‡³ğŸ‡¬ Nigeria (+234)</option>
                        <option value="+92">ğŸ‡µğŸ‡° Pakistan (+92)</option>
                        <option value="+880">ğŸ‡§ğŸ‡© Bangladesh (+880)</option>
                        <option value="+62">ğŸ‡®ğŸ‡© Indonesia (+62)</option>
                        <option value="+60">ğŸ‡²ğŸ‡¾ Malaysia (+60)</option>
                        <option value="+65">ğŸ‡¸ğŸ‡¬ Singapore (+65)</option>
                        <option value="+971">ğŸ‡¦ğŸ‡ª UAE (+971)</option>
                        <option value="+966">ğŸ‡¸ğŸ‡¦ Saudi Arabia (+966)</option>
                        <option value="+20">ğŸ‡ªğŸ‡¬ Egypt (+20)</option>
                        <option value="+27">ğŸ‡¿ğŸ‡¦ South Africa (+27)</option>
                        <option value="+254">ğŸ‡°ğŸ‡ª Kenya (+254)</option>
                        <option value="+233">ğŸ‡¬ğŸ‡­ Ghana (+233)</option>
                        <option value="+212">ğŸ‡²ğŸ‡¦ Morocco (+212)</option>
                        <option value="+213">ğŸ‡©ğŸ‡¿ Algeria (+213)</option>
                        <option value="+216">ğŸ‡¹ğŸ‡³ Tunisia (+216)</option>
                        <option value="+218">ğŸ‡±ğŸ‡¾ Libya (+218)</option>
                        <option value="+249">ğŸ‡¸ğŸ‡© Sudan (+249)</option>
                        <option value="+256">ğŸ‡ºğŸ‡¬ Uganda (+256)</option>
                        <option value="+255">ğŸ‡¹ğŸ‡¿ Tanzania (+255)</option>
                        <option value="+250">ğŸ‡·ğŸ‡¼ Rwanda (+250)</option>
                        <option value="+251">ğŸ‡ªğŸ‡¹ Ethiopia (+251)</option>
                        <option value="+252">ğŸ‡¸ğŸ‡´ Somalia (+252)</option>
                        <option value="+253">ğŸ‡©ğŸ‡¯ Djibouti (+253)</option>
                        <option value="+261">ğŸ‡²ğŸ‡¬ Madagascar (+261)</option>
                        <option value="+230">ğŸ‡²ğŸ‡º Mauritius (+230)</option>
                        <option value="+248">ğŸ‡¸ğŸ‡¨ Seychelles (+248)</option>
                        <option value="+33">ğŸ‡«ğŸ‡· France (+33)</option>
                        <option value="+49">ğŸ‡©ğŸ‡ª Germany (+49)</option>
                        <option value="+39">ğŸ‡®ğŸ‡¹ Italy (+39)</option>
                        <option value="+34">ğŸ‡ªğŸ‡¸ Spain (+34)</option>
                        <option value="+31">ğŸ‡³ğŸ‡± Netherlands (+31)</option>
                        <option value="+32">ğŸ‡§ğŸ‡ª Belgium (+32)</option>
                        <option value="+41">ğŸ‡¨ğŸ‡­ Switzerland (+41)</option>
                        <option value="+43">ğŸ‡¦ğŸ‡¹ Austria (+43)</option>
                        <option value="+46">ğŸ‡¸ğŸ‡ª Sweden (+46)</option>
                        <option value="+47">ğŸ‡³ğŸ‡´ Norway (+47)</option>
                        <option value="+45">ğŸ‡©ğŸ‡° Denmark (+45)</option>
                        <option value="+358">ğŸ‡«ğŸ‡® Finland (+358)</option>
                        <option value="+7">ğŸ‡·ğŸ‡º Russia (+7)</option>
                        <option value="+86">ğŸ‡¨ğŸ‡³ China (+86)</option>
                        <option value="+81">ğŸ‡¯ğŸ‡µ Japan (+81)</option>
                        <option value="+82">ğŸ‡°ğŸ‡· South Korea (+82)</option>
                        <option value="+66">ğŸ‡¹ğŸ‡­ Thailand (+66)</option>
                        <option value="+84">ğŸ‡»ğŸ‡³ Vietnam (+84)</option>
                        <option value="+63">ğŸ‡µğŸ‡­ Philippines (+63)</option>
                        <option value="+61">ğŸ‡¦ğŸ‡º Australia (+61)</option>
                        <option value="+64">ğŸ‡³ğŸ‡¿ New Zealand (+64)</option>
                        <option value="+55">ğŸ‡§ğŸ‡· Brazil (+55)</option>
                        <option value="+52">ğŸ‡²ğŸ‡½ Mexico (+52)</option>
                        <option value="+54">ğŸ‡¦ğŸ‡· Argentina (+54)</option>
                        <option value="+56">ğŸ‡¨ğŸ‡± Chile (+56)</option>
                        <option value="+57">ğŸ‡¨ğŸ‡´ Colombia (+57)</option>
                        <option value="+51">ğŸ‡µğŸ‡ª Peru (+51)</option>
                        <option value="+58">ğŸ‡»ğŸ‡ª Venezuela (+58)</option>
                        <option value="+593">ğŸ‡ªğŸ‡¨ Ecuador (+593)</option>
                        <option value="+595">ğŸ‡µğŸ‡¾ Paraguay (+595)</option>
                        <option value="+598">ğŸ‡ºğŸ‡¾ Uruguay (+598)</option>
                        <option value="+591">ğŸ‡§ğŸ‡´ Bolivia (+591)</option>
                        <option value="+592">ğŸ‡¬ğŸ‡¾ Guyana (+592)</option>
                        <option value="+597">ğŸ‡¸ğŸ‡· Suriname (+597)</option>
                        <option value="+594">ğŸ‡¬ğŸ‡« French Guiana (+594)</option>
                    </select>
                </div>
                <div>
                    <label for="signupWhatsapp" class="block text-sm font-bold text-gray-700 mb-2">ğŸ“± WhatsApp Number</label>
                    <input type="tel" id="signupWhatsapp" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Enter WhatsApp number (without country code)" required pattern="[0-9]{7,15}">
                    <p class="text-xs text-gray-500 mt-1">Enter only the number without country code</p>
                </div>
                <div>
                    <label for="signupPassword" class="block text-sm font-bold text-gray-700 mb-2">ğŸ”’ Password</label>
                    <input type="password" id="signupPassword" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Create strong password" required minlength="6">
                </div>
                <div>
                    <label for="confirmPassword" class="block text-sm font-bold text-gray-700 mb-2">ğŸ”’ Confirm Password</label>
                    <input type="password" id="confirmPassword" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-purple-50" placeholder="Confirm your password" required minlength="6">
                </div>
                <div>
                    <label for="referralCode" class="block text-sm font-bold text-gray-700 mb-2">ğŸ¯ Referral Code (Required)</label>
                    <input type="text" id="referralCode" class="w-full px-4 py-3 border-2 border-orange-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent bg-orange-50" placeholder="Enter valid referral code" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:from-green-600 hover:to-blue-600 transition-all shadow-lg transform hover:scale-105">âœ¨ Create Account</button>
            </form>
            
            <div id="authMessage" class="mt-4 text-center text-sm hidden"></div>
        </div>
    </div>
    
    <div id="userDashboard" class="hidden min-h-full">
        <nav class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 shadow-2xl">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸ’°</div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">Uthman Task Earn</h1>
                            <span id="userWelcome" class="text-purple-100 text-sm"></span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="bg-gradient-to-r from-yellow-400 to-orange-400 px-6 py-3 rounded-2xl shadow-lg">
                            <span class="text-white font-bold">ğŸ’° <span id="userCoins">0</span> Coins</span>
                        </div>
                        <button id="notificationsBtn" class="relative bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-3 rounded-2xl font-bold hover:from-blue-600 hover:to-purple-600 transition-all shadow-lg">
                            ğŸ”” <span id="notificationCount" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full px-2 py-1">0</span>
                        </button>
                        <button id="logoutBtn" class="bg-gradient-to-r from-red-500 to-pink-500 text-white px-6 py-3 rounded-2xl font-bold hover:from-red-600 hover:to-pink-600 transition-all shadow-lg">ğŸšª Logout</button>
                    </div>
                </div>
            </div>
        </nav>
        
        <div id="newsSection" class="max-w-7xl mx-auto p-6">
            <div id="newsList" class="space-y-4">
                </div>
        </div>
        
        <div class="max-w-7xl mx-auto p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-gradient-to-br from-green-400 to-blue-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ“Š Your Earnings</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Task Earnings:</span>
                            <span class="font-bold text-yellow-300" id="taskEarnings">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Referral Bonus:</span>
                            <span class="font-bold text-green-300" id="referralBonus">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Total Balance:</span>
                            <span class="font-bold text-orange-300" id="totalBalance">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-green-400 to-emerald-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ Daily Claim</h3>
                    <div class="space-y-3">
                        <div class="bg-white bg-opacity-20 rounded-xl p-3 text-center">
                            <div class="text-2xl font-bold" id="dailyClaimAmount">50</div>
                            <div class="text-sm">Coins Available</div>
                        </div>
                        <button id="claimDailyBtn" class="w-full bg-white text-green-500 py-3 rounded-xl font-bold hover:bg-gray-100 transition-colors shadow-lg">
                            ğŸ¯ Claim Daily Reward
                        </button>
                        <div class="text-center text-sm">
                            <div id="claimStatus">Ready to claim!</div>
                            <div id="nextClaimTime" class="text-xs text-green-200"></div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-purple-400 to-pink-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ‘¥ Referral System</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm mb-2 font-medium">Your Referral Code:</label>
                            <div class="flex">
                                <input type="text" id="myReferralCode" class="flex-1 px-3 py-2 border-2 border-white rounded-l-xl bg-white bg-opacity-20 text-white placeholder-gray-200" readonly>
                                <button id="copyReferralBtn" class="bg-white text-purple-500 px-4 py-2 rounded-r-xl hover:bg-gray-100 transition-colors font-bold">ğŸ“‹ Copy</button>
                            </div>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-xl p-3">
                            <p class="text-sm">ğŸ’¡ Share your code and earn bonus coins for each signup!</p>
                            <p class="text-xs mt-1">Total Referrals: <span id="totalReferrals">0</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-orange-400 to-red-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ’³ Withdrawal</h3>
                    <div id="withdrawalClosed" class="text-center py-4">
                        <div class="text-6xl mb-3">ğŸ”’</div>
                        <p class="font-medium">Withdrawal portal is currently closed</p>
                    </div>
                    <div id="withdrawalOpen" class="hidden">
                        <button id="withdrawBtn" class="w-full bg-white text-orange-500 py-3 rounded-xl font-bold hover:bg-gray-100 transition-colors shadow-lg">ğŸ’° Withdraw Funds</button>
                        <p class="text-sm mt-2 text-center">Min: <span id="minWithdrawal">100</span> coins</p>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-indigo-400 to-purple-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ‘‘ Your Level</h3>
                    <div id="userLevelInfo" class="space-y-3">
                        </div>
                </div>
                
                <div class="bg-gradient-to-br from-pink-400 to-red-500 rounded-3xl shadow-2xl p-6 text-white transform hover:scale-105 transition-all">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ Promo Code</h3>
                    <form id="promoCodeForm" class="space-y-3">
                        <input type="text" id="promoCodeInput" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Enter promo code">
                        <button type="submit" class="w-full bg-white text-pink-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ¯ Redeem Code</button>
                    </form>
                </div>
            </div>
            
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ”” Notifications</h3>
                <div id="notificationsList" class="space-y-3 max-h-60 overflow-y-auto">
                    </div>
            </div>
            
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ† Achievements</h3>
                <div id="achievementsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </div>
            
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ“ˆ Transaction History</h3>
                <div id="transactionHistory" class="space-y-3 max-h-60 overflow-y-auto">
                    </div>
            </div>
            
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ’¬ Message Admin</h3>
                <form id="messageAdminForm" class="space-y-4">
                    <div>
                        <label for="messageSubject" class="block text-sm font-bold text-gray-700 mb-2">Subject</label>
                        <input type="text" id="messageSubject" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Enter message subject" required>
                    </div>
                    <div>
                        <label for="messageContent" class="block text-sm font-bold text-gray-700 mb-2">Message</label>
                        <textarea id="messageContent" rows="4" class="w-full px-4 py-3 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500" placeholder="Type your message to admin..." required></textarea>
                    </div>
                    <button type="submit" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl font-bold hover:from-blue-600 hover:to-purple-600 transition-all shadow-lg">ğŸ“¨ Send Message</button>
                </form>
                
                <div class="mt-6">
                    <h4 class="font-bold text-gray-700 mb-3">Admin Replies:</h4>
                    <div id="adminRepliesList" class="space-y-3 max-h-60 overflow-y-auto">
                        </div>
                </div>
            </div>

            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ¯ Available Tasks</h3>
                <div class="mb-4">
                    <label for="taskFilter" class="block text-sm font-bold text-gray-700 mb-2">Filter by Category:</label>
                    <select id="taskFilter" class="px-4 py-2 border-2 border-purple-200 rounded-xl focus:ring-2 focus:ring-purple-500">
                        <option value="all">All Categories</option>
                        <option value="social">Social Media</option>
                        <option value="survey">Survey</option>
                        <option value="download">Download</option>
                        <option value="review">Review</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div id="tasksList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    </div>
            </div>
            
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">â“ Frequently Asked Questions</h3>
                <div id="faqSection" class="space-y-4">
                    </div>
            </div>
        </div>
    </div>
    
    <div id="adminDashboard" class="hidden min-h-full">
        <nav class="bg-gradient-to-r from-red-600 via-purple-600 to-indigo-600 text-white shadow-2xl">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="text-3xl">ğŸ”§</div>
                        <h1 class="text-2xl font-bold">Admin Control Panel</h1>
                    </div>
                    <button id="adminLogoutBtn" class="bg-red-700 px-6 py-3 rounded-2xl hover:bg-red-800 transition-colors font-bold shadow-lg">ğŸšª Logout</button>
                </div>
            </div>
        </nav>
        
        <div class="max-w-7xl mx-auto p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                <div class="bg-gradient-to-br from-blue-400 to-purple-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ“Š Platform Stats</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Total Users:</span>
                            <span class="font-bold text-yellow-300" id="totalSignups">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Blocked Users:</span>
                            <span class="font-bold text-red-300" id="blockedUsers">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Pending Tasks:</span>
                            <span class="font-bold text-orange-300" id="pendingTasks">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-green-400 to-teal-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ’³ Withdrawal Control</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Portal Status:</span>
                            <button id="toggleWithdrawal" class="bg-red-500 text-white px-4 py-2 rounded-xl hover:bg-red-600 transition-colors font-bold">Closed</button>
                        </div>
                        <div>
                            <label class="block text-sm mb-2 font-medium">Minimum Withdrawal:</label>
                            <input type="number" id="minWithdrawalInput" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="100" min="1">
                            <button id="updateMinWithdrawal" class="w-full mt-2 bg-white text-green-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">Update</button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-orange-400 to-red-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ‘¥ User Management</h3>
                    <div class="space-y-3">
                        <input type="text" id="blockUsername" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Username to block">
                        <button id="blockUserBtn" class="w-full bg-white text-red-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸš« Block User</button>
                        <button id="viewUsersBtn" class="w-full bg-white text-orange-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">ğŸ‘€ View All Users</button>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-cyan-400 to-blue-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ“Š Analytics</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Today's Signups:</span>
                            <span class="font-bold text-yellow-300" id="todaySignups">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Active Users:</span>
                            <span class="font-bold text-green-300" id="activeUsers">0</span>
                        </div>
                        <div class="flex justify-between items-center bg-white bg-opacity-20 rounded-xl p-3">
                            <span>Total Earnings:</span>
                            <span class="font-bold text-orange-300" id="totalEarnings">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ Promo Codes</h3>
                    <form id="adminPromoCodeForm" class="space-y-3">
                        <input type="text" id="newPromoCode" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="New Code (e.g., FREE100)">
                        <input type="number" id="promoCodeReward" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Reward in Coins (e.g., 100)">
                        <button type="submit" class="w-full bg-white text-orange-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">â• Add Promo Code</button>
                    </form>
                    <div class="mt-4 text-sm text-center text-yellow-100">Existing Codes: <span id="existingPromoCodes">None</span></div>
                </div>
                
                <div class="bg-gradient-to-br from-red-400 to-pink-500 rounded-3xl shadow-2xl p-6 text-white">
                    <h3 class="text-xl font-bold mb-4 flex items-center">ğŸ¯ Task Management</h3>
                    <form id="addTaskForm" class="space-y-3">
                        <input type="text" id="newTaskName" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Task Name (e.g., Follow on IG)">
                        <select id="newTaskCategory" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white">
                            <option value="social">Social Media</option>
                            <option value="survey">Survey</option>
                            <option value="download">Download</option>
                            <option value="review">Review</option>
                            <option value="other">Other</option>
                        </select>
                        <input type="number" id="newTaskReward" class="w-full px-3 py-2 border-2 border-white rounded-xl bg-white bg-opacity-20 text-white placeholder-gray-200" placeholder="Reward (Coins)">
                        <button type="submit" class="w-full bg-white text-pink-500 py-2 rounded-xl font-bold hover:bg-gray-100 transition-colors">â• Add New Task</button>
                    </form>
                    <div id="adminTasksList" class="mt-4 space-y-2 max-h-40 overflow-y-auto">
                        </div>
                </div>
            </div>
            
            <div class="mt-8 bg-white rounded-3xl shadow-2xl p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">ğŸ’° Pending Withdrawals</h3>
                <div id="pendingWithdrawalsList" class="space-y-3 max-h-60 overflow-y-auto">
                    <p class="text-center text-gray-500">No pending requests.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- State Variables (Master lists and user data stored in localStorage) ---
        let isLoggedIn = false;
        let isAdmin = false;
        
        // Master list of all users, tracked by username
        let allUsers = {}; 

        // The current user's session data
        let userData = {
            username: '',
            coins: 0,
            taskEarnings: 0,
            referralBonus: 0,
            totalReferrals: 0,
            level: 1,
            referralCode: 'UTHMAN123', 
            lastClaimTime: 0,
            notifications: [{ id: 1, message: 'Welcome to Uthman Task Earn! Start completing tasks to earn coins.', time: new Date().toLocaleTimeString(), read: false }],
            transactions: [],
            messages: [],
            achievements: [
                { id: 1, name: 'First Login', completed: true, reward: 100, description: 'Log in for the first time.' },
                { id: 2, name: '10 Tasks Done', completed: false, reward: 500, description: 'Complete 10 tasks.' },
                { id: 3, name: 'Refer 5 Friends', completed: false, reward: 1000, description: 'Get 5 active referrals.' }
            ],
            // New user properties to track for full profile
            password: '', 
            countryCode: '',
            whatsappNumber: '',
            isBlocked: false,
        };

        let platformSettings = {
            withdrawalOpen: false,
            minWithdrawal: 100,
            dailyClaimAmount: 50,
            news: [
                { id: 1, title: 'Withdrawal Maintenance', content: 'The withdrawal portal will be closed until next week for system updates.', type: 'alert' },
                { id: 2, title: 'New Social Media Tasks!', content: 'Earn 100 coins per follow on Instagram and TikTok!', type: 'success' }
            ],
            tasks: [
                { id: 1, name: 'Follow us on Twitter', category: 'social', reward: 50, status: 'available' },
                { id: 2, name: 'Complete 5-min Survey', category: 'survey', reward: 150, status: 'available' },
                { id: 3, name: 'Download App X', category: 'download', reward: 100, status: 'available' },
                { id: 4, name: 'Write a Review', category: 'review', reward: 80, status: 'available' }
            ],
            promoCodes: [
                { code: 'WELCOMENOW', reward: 50, uses: 0, maxUses: 100 }
            ]
        };
        
        // Admin state (simple check for demo)
        const ADMIN_USERNAME = 'admin';
        const ADMIN_PASSWORD = 'admin';


        // --- DOM Elements ---
        const authPage = document.getElementById('authPage');
        const userDashboard = document.getElementById('userDashboard');
        const adminDashboard = document.getElementById('adminDashboard');
        const loginTab = document.getElementById('loginTab');
        const signupTab = document.getElementById('signupTab');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const authMessage = document.getElementById('authMessage');
        const telegramPopup = document.getElementById('telegramPopup');
        const telegramFloat = document.getElementById('telegramFloat');
        const closeTelegramPopup = document.getElementById('closeTelegramPopup');
        const telegramBtn = document.getElementById('telegramBtn');
        
        // Dashboard Elements
        const userWelcome = document.getElementById('userWelcome');
        const userCoins = document.getElementById('userCoins');
        const taskEarnings = document.getElementById('taskEarnings');
        const referralBonus = document.getElementById('referralBonus');
        const totalBalance = document.getElementById('totalBalance');
        const dailyClaimAmount = document.getElementById('dailyClaimAmount');
        const claimDailyBtn = document.getElementById('claimDailyBtn');
        const claimStatus = document.getElementById('claimStatus');
        const nextClaimTime = document.getElementById('nextClaimTime');
        const myReferralCode = document.getElementById('myReferralCode');
        const copyReferralBtn = document.getElementById('copyReferralBtn');
        const totalReferrals = document.getElementById('totalReferrals');
        const withdrawalClosed = document.getElementById('withdrawalClosed');
        const withdrawalOpen = document.getElementById('withdrawalOpen');
        const minWithdrawal = document.getElementById('minWithdrawal');
        const notificationsList = document.getElementById('notificationsList');
        const notificationsBtn = document.getElementById('notificationsBtn');
        const notificationCount = document.getElementById('notificationCount');
        const tasksList = document.getElementById('tasksList');
        const taskFilter = document.getElementById('taskFilter');
        const newsList = document.getElementById('newsList');
        const achievementsList = document.getElementById('achievementsList');
        const transactionHistory = document.getElementById('transactionHistory');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');

        // Admin Elements
        const toggleWithdrawal = document.getElementById('toggleWithdrawal');
        const minWithdrawalInput = document.getElementById('minWithdrawalInput');
        const updateMinWithdrawal = document.getElementById('updateMinWithdrawal');
        const totalSignups = document.getElementById('totalSignups');
        const blockedUsers = document.getElementById('blockedUsers'); // New!
        const pendingTasks = document.getElementById('pendingTasks');
        const addTaskForm = document.getElementById('addTaskForm');
        const adminTasksList = document.getElementById('adminTasksList');
        const promoCodeManagementForm = document.getElementById('adminPromoCodeForm');


        // --- Functions ---

        // A utility function to save and load state (using localStorage for this demo)
        function saveState() {
            // Save the current user's data back to the master list if they are logged in and not admin
            if (isLoggedIn && !isAdmin) {
                allUsers[userData.username] = userData;
            }

            localStorage.setItem('userData', JSON.stringify(userData));
            localStorage.setItem('platformSettings', JSON.stringify(platformSettings));
            localStorage.setItem('isLoggedIn', isLoggedIn);
            localStorage.setItem('isAdmin', isAdmin);
            
            // Save the master list of all users
            localStorage.setItem('allUsers', JSON.stringify(allUsers)); 
        }

        function loadState() {
            const savedUserData = localStorage.getItem('userData');
            const savedSettings = localStorage.getItem('platformSettings');
            const savedLoggedIn = localStorage.getItem('isLoggedIn');
            const savedIsAdmin = localStorage.getItem('isAdmin');
            const savedAllUsers = localStorage.getItem('allUsers'); 

            if (savedUserData && savedUserData !== 'null') {
                userData = JSON.parse(savedUserData);
            }
            if (savedSettings) {
                platformSettings = JSON.parse(savedSettings);
            }
            // Initialize allUsers if it exists
            if (savedAllUsers) {
                allUsers = JSON.parse(savedAllUsers);
            }

            isLoggedIn = savedLoggedIn === 'true';
            isAdmin = savedIsAdmin === 'true';
        }

        function displayMessage(message, isError = false) {
            authMessage.textContent = message;
            authMessage.className = `mt-4 text-center text-sm fade-in ${isError ? 'text-red-500 font-bold' : 'text-green-500 font-bold'}`;
            authMessage.classList.remove('hidden');
            setTimeout(() => {
                authMessage.classList.add('hidden');
            }, 3000);
        }

        function updateDashboard() {
            userDashboard.classList.add('fade-in');
            
            // Update user data
            userWelcome.textContent = `Welcome, ${userData.username}!`;
            userCoins.textContent = userData.coins.toLocaleString();
            taskEarnings.textContent = userData.taskEarnings.toLocaleString();
            referralBonus.textContent = userData.referralBonus.toLocaleString();
            totalBalance.textContent = (userData.coins + userData.taskEarnings + userData.referralBonus).toLocaleString();
            myReferralCode.value = userData.referralCode;
            totalReferrals.textContent = userData.totalReferrals;
            
            // Update daily claim status
            updateDailyClaimStatus();

            // Update withdrawal status
            if (platformSettings.withdrawalOpen) {
                withdrawalClosed.classList.add('hidden');
                withdrawalOpen.classList.remove('hidden');
            } else {
                withdrawalClosed.classList.remove('hidden');
                withdrawalOpen.classList.add('hidden');
            }
            minWithdrawal.textContent = platformSettings.minWithdrawal;

            // Populate dynamic lists
            populateNews();
            populateNotifications();
            populateAchievements();
            populateTransactions();
            populateTasks();
        }

        function updateAdminDashboard() {
            adminDashboard.classList.add('fade-in');
            
            // --- Update Stats Card (Dynamic User Count) ---
            const userCount = Object.keys(allUsers).length;
            totalSignups.textContent = userCount.toLocaleString();
            
            const blockedUserCount = Object.values(allUsers).filter(user => user.isBlocked).length;
            blockedUsers.textContent = blockedUserCount; 
            
            pendingTasks.textContent = platformSettings.tasks.length; // Simple count for mock
            document.getElementById('todaySignups').textContent = '25'; // Mock
            document.getElementById('activeUsers').textContent = '150'; // Mock
            document.getElementById('totalEarnings').textContent = '5,400,000'; // Mock

            // Update Withdrawal Control
            toggleWithdrawal.textContent = platformSettings.withdrawalOpen ? 'Open' : 'Closed';
            toggleWithdrawal.classList.toggle('bg-red-500', !platformSettings.withdrawalOpen);
            toggleWithdrawal.classList.toggle('bg-green-500', platformSettings.withdrawalOpen);
            minWithdrawalInput.value = platformSettings.minWithdrawal;
            
            // Populate Admin Management sections
            populateAdminTaskManagement();
            populateAdminMessageReplies();
        }

        // ... (The rest of the rendering/utility functions remain the same) ...

        function populateNews() {
            newsList.innerHTML = platformSettings.news.map(item => {
                let color = item.type === 'alert' ? 'bg-red-500' : 'bg-green-500';
                let icon = item.type === 'alert' ? 'ğŸš¨' : 'âœ¨';
                return `
                    <div class="bg-white p-4 rounded-xl shadow-md border-l-4 ${color}">
                        <div class="flex items-start">
                            <div class="text-2xl mr-3">${icon}</div>
                            <div>
                                <p class="font-bold text-gray-800">${item.title}</p>
                                <p class="text-sm text-gray-600">${item.content}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function populateNotifications() {
            notificationsList.innerHTML = userData.notifications.map(n => `
                <div class="flex justify-between items-center p-3 rounded-xl ${n.read ? 'bg-gray-100 text-gray-500' : 'bg-purple-100 text-gray-800 font-medium'}">
                    <span>${n.read ? 'âœ…' : 'ğŸ””'} ${n.message}</span>
                    <span class="text-xs text-gray-400">${n.time}</span>
                </div>
            `).reverse().join(''); // Reverse to show latest first
            
            const unreadCount = userData.notifications.filter(n => !n.read).length;
            if (unreadCount > 0) {
                notificationCount.textContent = unreadCount;
                notificationCount.classList.remove('hidden');
            } else {
                notificationCount.classList.add('hidden');
            }
        }

        function populateAchievements() {
            achievementsList.innerHTML = userData.achievements.map(a => {
                const gradient = a.completed ? 'success-gradient' : 'warning-gradient';
                const icon = a.completed ? 'â­' : 'ğŸ”’';
                const status = a.completed ? 'Claimed' : 'Locked';
                return `
                    <div class="${gradient} text-white rounded-3xl shadow-lg p-4 fade-in">
                        <div class="text-3xl mb-2">${icon}</div>
                        <p class="font-bold">${a.name}</p>
                        <p class="text-sm">${a.description}</p>
                        <div class="flex justify-between items-center mt-3">
                            <span class="font-bold">${a.reward} Coins</span>
                            <span class="text-xs font-semibold px-2 py-1 rounded-lg ${a.completed ? 'bg-white text-green-500' : 'bg-white text-orange-500'}">${status}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function populateTransactions() {
            if (userData.transactions.length === 0) {
                transactionHistory.innerHTML = '<p class="text-center text-gray-500">No transactions recorded yet.</p>';
                return;
            }

            transactionHistory.innerHTML = userData.transactions.map(t => {
                const color = t.type === 'credit' ? 'text-green-500' : 'text-red-500';
                const sign = t.type === 'credit' ? '+' : '-';
                return `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl shadow-sm">
                        <span class="font-medium text-gray-700">${t.description}</span>
                        <span class="font-bold ${color}">${sign}${t.amount}</span>
                    </div>
                `;
            }).reverse().join('');
        }

        function populateTasks() {
            const filter = taskFilter.value;
            const filteredTasks = platformSettings.tasks.filter(task => 
                filter === 'all' || task.category === filter
            );

            if (filteredTasks.length === 0) {
                tasksList.innerHTML = '<p class="text-center text-gray-500 col-span-full">No tasks available in this category.</p>';
                return;
            }

            tasksList.innerHTML = filteredTasks.map(task => `
                <div id="task-${task.id}" class="bg-white rounded-3xl shadow-xl p-5 border-l-4 border-purple-500 fade-in">
                    <h4 class="text-xl font-bold text-gray-800 mb-2">${task.name}</h4>
                    <p class="text-sm text-gray-600 mb-3">Category: <span class="font-medium text-purple-600">${task.category.toUpperCase()}</span></p>
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-bold text-green-600 flex items-center">
                            <div class="text-2xl mr-1">ğŸ’°</div> ${task.reward} Coins
                        </span>
                        <button data-task-id="${task.id}" class="complete-task-btn bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-xl font-bold hover:from-blue-600 hover:to-purple-600 transition-all">
                            Do Task
                        </button>
                    </div>
                </div>
            `).join('');

            // Attach event listeners to new buttons
            document.querySelectorAll('.complete-task-btn').forEach(button => {
                button.addEventListener('click', handleTaskCompletion);
            });
        }

        function handleTaskCompletion(event) {
            const taskId = parseInt(event.currentTarget.dataset.taskId);
            const task = platformSettings.tasks.find(t => t.id === taskId);

            if (!task) return;

            // Basic simulation of task completion
            userData.coins += task.reward;
            userData.taskEarnings += task.reward;
            
            userData.transactions.push({
                description: `Task: ${task.name}`,
                amount: task.reward,
                type: 'credit'
            });

            userData.notifications.push({
                id: Date.now(),
                message: `Task Completed! You earned ${task.reward} coins.`,
                time: new Date().toLocaleTimeString(),
                read: false
            });

            // Remove task for this session (simulating completion)
            platformSettings.tasks = platformSettings.tasks.filter(t => t.id !== taskId);

            saveState();
            updateDashboard();
            
            // Add coin animation to the element
            const taskElement = document.getElementById(`task-${taskId}`);
            if(taskElement) {
                taskElement.classList.add('coin-animation');
                taskElement.style.pointerEvents = 'none'; // Disable interaction while animating/disappearing
                setTimeout(() => {
                    taskElement.remove();
                }, 600); // Remove after animation
            }
            
            alert(`Congratulations! You earned ${task.reward} coins for completing "${task.name}".`);
        }

        function updateDailyClaimStatus() {
            const lastClaim = userData.lastClaimTime;
            const twentyFourHours = 24 * 60 * 60 * 1000;
            const nextClaim = lastClaim + twentyFourHours;
            const now = Date.now();
            
            dailyClaimAmount.textContent = platformSettings.dailyClaimAmount;

            if (now >= nextClaim) {
                claimDailyBtn.disabled = false;
                claimDailyBtn.textContent = 'ğŸ¯ Claim Daily Reward';
                claimStatus.textContent = 'Ready to claim!';
                claimStatus.className = 'text-center text-sm text-green-500 font-bold';
                nextClaimTime.textContent = '';
            } else {
                claimDailyBtn.disabled = true;
                claimDailyBtn.textContent = 'Claimed! Wait for next day';
                claimStatus.textContent = 'Claimed today.';
                claimStatus.className = 'text-center text-sm text-orange-500 font-bold';

                // Calculate remaining time
                const remainingMs = nextClaim - now;
                const hours = Math.floor(remainingMs / (1000 * 60 * 60));
                const minutes = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingMs % (1000 * 60)) / 1000);

                nextClaimTime.textContent = `Next claim in: ${hours}h ${minutes}m ${seconds}s`;
            }
        }
        
        // Admin functions
        function populateAdminTaskManagement() {
            if (!adminTasksList) return;
            
            adminTasksList.innerHTML = platformSettings.tasks.map(task => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl shadow-sm">
                    <span>${task.name} (${task.reward} Coins)</span>
                    <button data-task-id="${task.id}" class="delete-task-btn bg-red-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-red-600">Delete</button>
                </div>
            `).join('');

            document.querySelectorAll('.delete-task-btn').forEach(button => {
                button.addEventListener('click', handleDeleteTask);
            });
        }
        
        function handleDeleteTask(event) {
            const taskId = parseInt(event.currentTarget.dataset.taskId);
            platformSettings.tasks = platformSettings.tasks.filter(t => t.id !== taskId);
            saveState();
            updateAdminDashboard();
            alert('Task deleted successfully.');
        }

        function populateAdminMessageReplies() {
            if (!document.getElementById('adminRepliesList')) return;
            
            const adminRepliesList = document.getElementById('adminRepliesList');
            if (userData.messages.length === 0) {
                adminRepliesList.innerHTML = '<p class="text-center text-gray-500">No messages sent yet.</p>';
                return;
            }

            adminRepliesList.innerHTML = userData.messages.map((m, index) => {
                const adminReply = index % 2 === 0 ? '<p class="text-sm text-blue-500 italic mt-1">Admin: Your request is being reviewed.</p>' : '';
                return `
                    <div class="p-3 bg-purple-50 rounded-xl shadow-sm">
                        <p class="font-bold text-gray-800">Subject: ${m.subject}</p>
                        <p class="text-sm text-gray-600">${m.content}</p>
                        ${adminReply}
                    </div>
                `;
            }).join('');
        }


        // --- Event Handlers ---

        // Auth Tab Switching
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white', 'shadow-lg');
            loginTab.classList.remove('bg-transparent', 'text-purple-600', 'shadow-none');
            signupTab.classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white', 'shadow-lg');
            signupTab.classList.add('bg-transparent', 'text-purple-600', 'shadow-none');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
        });

        signupTab.addEventListener('click', () => {
            signupTab.classList.add('bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white', 'shadow-lg');
            signupTab.classList.remove('bg-transparent', 'text-purple-600', 'shadow-none');
            loginTab.classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white', 'shadow-lg');
            loginTab.classList.add('bg-transparent', 'text-purple-600', 'shadow-none');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
        });
        
        // --- Login Submission (Updated to check allUsers) ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            // 1. Check for Admin Login
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                isAdmin = true;
                userData.username = username; // Temporary session data for admin
            // 2. Check the All Users list
            } else if (allUsers[username] && allUsers[username].password === password) { 
                const user = allUsers[username];
                if (user.isBlocked) {
                    displayMessage('Account blocked. Please contact support.', true);
                    return;
                }
                isLoggedIn = true;
                isAdmin = false;
                userData = user; // Load actual user data for the session
            } else {
                displayMessage('Invalid username or password.', true);
                return;
            }

            // Successful Login
            displayMessage(`Login successful! Redirecting...`, false);
            saveState(); // Save the new session state
            setTimeout(initializeApp, 1000);
        });

        // --- Signup Submission (Updated to save to allUsers) ---
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('signupUsername').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const countryCode = document.getElementById('signupCountryCode').value;
            const whatsapp = document.getElementById('signupWhatsapp').value;
            const referralCode = document.getElementById('referralCode').value;

            if (password !== confirmPassword) {
                displayMessage('Passwords do not match!', true);
                return;
            }
            
            if (allUsers[username]) {
                displayMessage('Username already taken. Please choose another.', true);
                return;
            }
            
            if (username.toLowerCase() === ADMIN_USERNAME) {
                displayMessage('Username is reserved. Choose another.', true);
                return;
            }

            // Create the new user object
            const newUser = {
                username: username,
                password: password, 
                coins: 100, // Signup bonus
                taskEarnings: 0,
                referralBonus: 0,
                totalReferrals: 0,
                level: 1,
                countryCode: countryCode,
                whatsappNumber: whatsapp,
                referralCode: username.toUpperCase().slice(0, 3) + Math.floor(Math.random() * 10000),
                lastClaimTime: 0,
                notifications: [{ id: 1, message: 'Welcome bonus claimed! (100 Coins)', time: new Date().toLocaleTimeString(), read: false }],
                transactions: [{
                    description: `Signup Bonus (Referral: ${referralCode})`,
                    amount: 100,
                    type: 'credit'
                }],
                messages: [],
                achievements: userData.achievements,
                isBlocked: false,
            };

            // 1. Add user to the master list
            allUsers[username] = newUser;
            
            // 2. Log the new user in
            isLoggedIn = true;
            isAdmin = false;
            userData = newUser; 

            displayMessage(`Account created! Welcome, ${username}.`, false);
            saveState(); // Saves the new user to allUsers
            setTimeout(initializeApp, 1000);
        });
        
        // Telegram Popup Handlers
        closeTelegramPopup.addEventListener('click', () => {
            telegramPopup.style.display = 'none';
            localStorage.setItem('telegramPopupDismissed', 'true');
        });

        telegramBtn.addEventListener('click', () => {
            window.open('https://t.me/yourtelegramchannel', '_blank'); // Replace with actual link
        });
        
        document.getElementById('joinTelegram').addEventListener('click', () => {
            telegramBtn.click();
            closeTelegramPopup.click();
        });

        // Dashboard Actions
        logoutBtn.addEventListener('click', () => {
            isLoggedIn = false;
            isAdmin = false;
            // Clear current user session data to prevent accidental reload
            userData = {}; 
            saveState();
            initializeApp();
        });

        adminLogoutBtn.addEventListener('click', logoutBtn.click);

        claimDailyBtn.addEventListener('click', () => {
            if (claimDailyBtn.disabled) return;

            userData.coins += platformSettings.dailyClaimAmount;
            userData.lastClaimTime = Date.now();

            userData.transactions.push({
                description: 'Daily Claim Reward',
                amount: platformSettings.dailyClaimAmount,
                type: 'credit'
            });
            
            userData.notifications.push({
                id: Date.now(),
                message: `You successfully claimed your ${platformSettings.dailyClaimAmount} coin daily reward!`,
                time: new Date().toLocaleTimeString(),
                read: false
            });

            saveState();
            updateDashboard();
            
            // Flash coin balance to show the update
            userCoins.parentNode.classList.add('coin-animation');
            setTimeout(() => {
                userCoins.parentNode.classList.remove('coin-animation');
            }, 600);
        });

        copyReferralBtn.addEventListener('click', () => {
            myReferralCode.select();
            document.execCommand('copy');
            alert('Referral Code Copied!');
        });

        notificationsBtn.addEventListener('click', () => {
            // Mark all as read
            userData.notifications.forEach(n => n.read = true);
            saveState();
            updateDashboard(); // Re-render to update the count
        });

        taskFilter.addEventListener('change', populateTasks);
        
        document.getElementById('messageAdminForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const subject = document.getElementById('messageSubject').value;
            const content = document.getElementById('messageContent').value;
            
            userData.messages.push({
                subject: subject,
                content: content,
                time: new Date().toLocaleString()
            });
            
            document.getElementById('messageAdminForm').reset();
            displayMessage('Message sent to Admin successfully!', false);
            saveState();
            populateAdminMessageReplies();
        });
        
        // Admin Control Handlers
        if (toggleWithdrawal) {
            toggleWithdrawal.addEventListener('click', () => {
                platformSettings.withdrawalOpen = !platformSettings.withdrawalOpen;
                saveState();
                updateAdminDashboard();
            });
        }

        if (updateMinWithdrawal) {
            updateMinWithdrawal.addEventListener('click', () => {
                const newMin = parseInt(minWithdrawalInput.value);
                if (newMin && newMin > 0) {
                    platformSettings.minWithdrawal = newMin;
                    saveState();
                    updateAdminDashboard();
                    alert(`Minimum withdrawal updated to ${newMin}`);
                } else {
                    alert('Please enter a valid minimum withdrawal amount.');
                }
            });
        }
        
        // Admin Task Add Handler
        if (addTaskForm) {
            addTaskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('newTaskName').value;
                const category = document.getElementById('newTaskCategory').value;
                const reward = parseInt(document.getElementById('newTaskReward').value);

                if (name && category && reward > 0) {
                    const newTask = {
                        id: Date.now(),
                        name: name,
                        category: category,
                        reward: reward,
                        status: 'available'
                    };
                    platformSettings.tasks.push(newTask);
                    saveState();
                    updateAdminDashboard();
                    alert('New task added successfully!');
                    addTaskForm.reset();
                } else {
                    alert('Please fill in all task fields correctly.');
                }
            });
        }
        
        // Admin Block User Handler (Basic Mock)
        if (document.getElementById('blockUserBtn')) {
            document.getElementById('blockUserBtn').addEventListener('click', () => {
                const usernameToBlock = document.getElementById('blockUsername').value.trim();
                if (allUsers[usernameToBlock]) {
                    allUsers[usernameToBlock].isBlocked = true;
                    saveState();
                    updateAdminDashboard();
                    alert(`User ${usernameToBlock} has been blocked.`);
                } else {
                    alert(`User ${usernameToBlock} not found.`);
                }
            });
        }

        // Initialize the Application
        function initializeApp() {
            loadState();
            
            // Hide all and show the correct page
            authPage.classList.add('hidden');
            userDashboard.classList.add('hidden');
            adminDashboard.classList.add('hidden');

            if (isLoggedIn) {
                if (isAdmin) {
                    adminDashboard.classList.remove('hidden');
                    updateAdminDashboard();
                } else {
                    userDashboard.classList.remove('hidden');
                    updateDashboard();
                    // Start the daily claim timer update
                    if(userData.lastClaimTime > 0) {
                        setInterval(updateDailyClaimStatus, 1000);
                    }
                }
                telegramFloat.classList.remove('hidden');
            } else {
                authPage.classList.remove('hidden');
                telegramFloat.classList.remove('hidden');
                
                // Show telegram popup once per session
                if (localStorage.getItem('telegramPopupDismissed') !== 'true') {
                    telegramPopup.classList.remove('hidden');
                } else {
                    telegramPopup.classList.add('hidden');
                }
            }
        }

        // Run the main initialization function
        initializeApp();
        
    </script>
</body>
</html>
